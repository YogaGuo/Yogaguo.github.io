<!doctype html>



  


<html class="theme-next mist use-motion" lang="zh-CN">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">



<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css">


  <meta name="keywords" content="Hexo, NexT">





  <link rel="alternate" href="/atom.xml" title="小鱼儿的技术博客" type="application/atom+xml">




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0">






<meta name="description" content="技术博客，Java编程，算法学习">
<meta property="og:type" content="website">
<meta property="og:title" content="小鱼儿的技术博客">
<meta property="og:url" content="https://Yogaguo.github.io/index.html">
<meta property="og:site_name" content="小鱼儿的技术博客">
<meta property="og:description" content="技术博客，Java编程，算法学习">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="小鱼儿的技术博客">
<meta name="twitter:description" content="技术博客，Java编程，算法学习">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://Yogaguo.github.io/">





  <title> 小鱼儿的技术博客 </title>
<link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css"></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  














  
  
    
  

  <div class="container sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">小鱼儿的技术博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">走出生活舒适圈</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            Tags
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://Yogaguo.github.io/2020/02/14/Demo2020-02-13blog/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="小鱼儿">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="小鱼儿的技术博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2020/02/14/Demo2020-02-13blog/" itemprop="url">
                  Spring基础学习02
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-02-14T19:30:40+08:00">
                2020-02-14
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/spring基础学习/" itemprop="url" rel="index">
                    <span itemprop="name">spring基础学习</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3>   <a href="/2020/02/14/Demo2020-02-14blog/" title="Spring基础学习01">Spring基础学习01</a>

<ul>
<li><p><strong>先用上篇文章学过的基于xml的IOC完成简单的数据库操作</strong> </p>
<p> 搭建环境不展示 项目结构如下图</p>
 <img src="/2020/02/14/Demo2020-02-13blog/img01.png">
</li>
<li><p>Maven工厂构建spring开发环境 ,导入坐标  </p>
<pre class=" language-java"><code class="language-java">   <span class="token operator">&lt;</span>dependency<span class="token operator">></span>
             <span class="token operator">&lt;</span>groupId<span class="token operator">></span>org<span class="token punctuation">.</span>springframework<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">></span>
             <span class="token operator">&lt;</span>artifactId<span class="token operator">></span>spring<span class="token operator">-</span>context<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">></span>
             <span class="token operator">&lt;</span>version<span class="token operator">></span><span class="token number">5.2</span><span class="token punctuation">.</span><span class="token number">1</span><span class="token punctuation">.</span>RELEASE<span class="token operator">&lt;</span><span class="token operator">/</span>version<span class="token operator">></span>
         <span class="token operator">&lt;</span><span class="token operator">/</span>dependency<span class="token operator">></span>
         <span class="token operator">&lt;</span>dependency<span class="token operator">></span>
             <span class="token operator">&lt;</span>groupId<span class="token operator">></span>commons<span class="token operator">-</span>dbutils<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">></span>
             <span class="token operator">&lt;</span>artifactId<span class="token operator">></span>commons<span class="token operator">-</span>dbutils<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">></span>
             <span class="token operator">&lt;</span>version<span class="token operator">></span><span class="token number">1.4</span><span class="token operator">&lt;</span><span class="token operator">/</span>version<span class="token operator">></span>
         <span class="token operator">&lt;</span><span class="token operator">/</span>dependency<span class="token operator">></span>
         <span class="token operator">&lt;</span>dependency<span class="token operator">></span>
             <span class="token operator">&lt;</span>groupId<span class="token operator">></span>mysql<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">></span>
             <span class="token operator">&lt;</span>artifactId<span class="token operator">></span>mysql<span class="token operator">-</span>connector<span class="token operator">-</span>java<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">></span>
             <span class="token operator">&lt;</span>version<span class="token operator">></span><span class="token number">5.1</span><span class="token punctuation">.</span><span class="token number">39</span><span class="token operator">&lt;</span><span class="token operator">/</span>version<span class="token operator">></span>
         <span class="token operator">&lt;</span><span class="token operator">/</span>dependency<span class="token operator">></span>
         <span class="token operator">&lt;</span>dependency<span class="token operator">></span>
             <span class="token operator">&lt;</span>groupId<span class="token operator">></span>junit<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">></span>
             <span class="token operator">&lt;</span>artifactId<span class="token operator">></span>junit<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">></span>
             <span class="token operator">&lt;</span>version<span class="token operator">></span><span class="token number">4.12</span><span class="token operator">&lt;</span><span class="token operator">/</span>version<span class="token operator">></span>
         <span class="token operator">&lt;</span><span class="token operator">/</span>dependency<span class="token operator">></span>
         <span class="token operator">&lt;</span>dependency<span class="token operator">></span>
             <span class="token operator">&lt;</span>groupId<span class="token operator">></span>org<span class="token punctuation">.</span>springframework<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">></span>
             <span class="token operator">&lt;</span>artifactId<span class="token operator">></span>spring<span class="token operator">-</span>test<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">></span>
             <span class="token operator">&lt;</span>version<span class="token operator">></span><span class="token number">5.2</span><span class="token punctuation">.</span><span class="token number">1</span><span class="token punctuation">.</span>RELEASE<span class="token operator">&lt;</span><span class="token operator">/</span>version<span class="token operator">></span>
         <span class="token operator">&lt;</span><span class="token operator">/</span>dependency<span class="token operator">></span>
     <span class="token operator">&lt;</span><span class="token operator">/</span>dependencies<span class="token operator">></span></code></pre>
</li>
</ul>
<ul>
<li><p>核心代码  </p>
<ul>
<li>业务层实现类</li>
</ul>
<pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>Yogaguo<span class="token punctuation">.</span>service<span class="token punctuation">.</span>impl<span class="token punctuation">;</span>

<span class="token keyword">import</span> com<span class="token punctuation">.</span>Yogaguo<span class="token punctuation">.</span>dao<span class="token punctuation">.</span>IAccountDao<span class="token punctuation">;</span>
<span class="token keyword">import</span> com<span class="token punctuation">.</span>Yogaguo<span class="token punctuation">.</span>domain<span class="token punctuation">.</span>Account<span class="token punctuation">;</span>
<span class="token keyword">import</span> com<span class="token punctuation">.</span>Yogaguo<span class="token punctuation">.</span>service<span class="token punctuation">.</span>IAccountService<span class="token punctuation">;</span>

<span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>List<span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AccountServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">IAccountService</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> IAccountDao accountDao<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setAccountDao</span><span class="token punctuation">(</span>IAccountDao accountDao<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>accountDao <span class="token operator">=</span> accountDao<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> List<span class="token operator">&lt;</span>Account<span class="token operator">></span> <span class="token function">findAllAccount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> accountDao<span class="token punctuation">.</span><span class="token function">findAllAccount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> Account <span class="token function">findAccouuntById</span><span class="token punctuation">(</span><span class="token keyword">int</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword">return</span> accountDao<span class="token punctuation">.</span><span class="token function">findAccouuntById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">saveAccount</span><span class="token punctuation">(</span>Account account<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        accountDao<span class="token punctuation">.</span><span class="token function">saveAccount</span><span class="token punctuation">(</span>account<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">updateAccount</span><span class="token punctuation">(</span>Account account<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          accountDao<span class="token punctuation">.</span><span class="token function">updateAccount</span><span class="token punctuation">(</span>account<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">deleteAccount</span><span class="token punctuation">(</span><span class="token keyword">int</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          accountDao<span class="token punctuation">.</span><span class="token function">deleteAccount</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
</li>
</ul>
<ul>
<li><p>Dao层实现类</p>
<pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>Yogaguo<span class="token punctuation">.</span>dao<span class="token punctuation">.</span>ipml<span class="token punctuation">;</span>

<span class="token keyword">import</span> com<span class="token punctuation">.</span>Yogaguo<span class="token punctuation">.</span>dao<span class="token punctuation">.</span>IAccountDao<span class="token punctuation">;</span>
<span class="token keyword">import</span> com<span class="token punctuation">.</span>Yogaguo<span class="token punctuation">.</span>domain<span class="token punctuation">.</span>Account<span class="token punctuation">;</span>
<span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>dbutils<span class="token punctuation">.</span>QueryRunner<span class="token punctuation">;</span>
<span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>dbutils<span class="token punctuation">.</span>handlers<span class="token punctuation">.</span>BeanHandler<span class="token punctuation">;</span>
<span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>dbutils<span class="token punctuation">.</span>handlers<span class="token punctuation">.</span>BeanListHandler<span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AccountDaoImpl</span> <span class="token keyword">implements</span> <span class="token class-name">IAccountDao</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> QueryRunner runner<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setRunner</span><span class="token punctuation">(</span>QueryRunner runner<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>runner <span class="token operator">=</span> runner<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> List<span class="token operator">&lt;</span>Account<span class="token operator">></span> <span class="token function">findAllAccount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> runner<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string">"select * from user"</span><span class="token punctuation">,</span><span class="token keyword">new</span> <span class="token class-name">BeanListHandler</span><span class="token operator">&lt;</span>Account<span class="token operator">></span><span class="token punctuation">(</span>Account<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SQLException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
             <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> Account <span class="token function">findAccouuntById</span><span class="token punctuation">(</span><span class="token keyword">int</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> runner<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string">"select * from user where id=?"</span><span class="token punctuation">,</span><span class="token keyword">new</span> <span class="token class-name">BeanHandler</span><span class="token operator">&lt;</span>Account<span class="token operator">></span><span class="token punctuation">(</span>Account<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">,</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SQLException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">saveAccount</span><span class="token punctuation">(</span>Account account<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            runner<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token string">"insert into user(username,password)values(?,?)"</span><span class="token punctuation">,</span>account<span class="token punctuation">.</span><span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>account<span class="token punctuation">.</span><span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SQLException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">updateAccount</span><span class="token punctuation">(</span>Account account<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
           runner<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token string">"update user set username=?,password=? where id=?"</span><span class="token punctuation">,</span>account<span class="token punctuation">.</span><span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>account<span class="token punctuation">.</span><span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>account<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SQLException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">deleteAccount</span><span class="token punctuation">(</span><span class="token keyword">int</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            runner<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token string">"delete from user where id=?"</span><span class="token punctuation">,</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SQLException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
</li>
<li><p>XML配置  </p>
<pre class=" language-java"><code class="language-java"><span class="token operator">&lt;</span>beans xmlns<span class="token operator">=</span><span class="token string">"http://www.springframework.org/schema/beans"</span>
     xmlns<span class="token operator">:</span>xsi<span class="token operator">=</span><span class="token string">"http://www.w3.org/2001/XMLSchema-instance"</span>
     xsi<span class="token operator">:</span>schemaLocation<span class="token operator">=</span>"http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>www<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>org<span class="token operator">/</span>schema<span class="token operator">/</span>beans
      http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>www<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>org<span class="token operator">/</span>schema<span class="token operator">/</span>beans<span class="token operator">/</span>spring<span class="token operator">-</span>beans<span class="token punctuation">.</span>xsd"<span class="token operator">></span>
  <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>配置Service对象<span class="token operator">--</span><span class="token operator">></span>
  <span class="token operator">&lt;</span>bean id<span class="token operator">=</span><span class="token string">"accountService"</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"com.Yogaguo.service.impl.AccountServiceImpl"</span><span class="token operator">></span>
      <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>注入dao对象<span class="token operator">--</span><span class="token operator">></span>
      <span class="token operator">&lt;</span>property name<span class="token operator">=</span><span class="token string">"accountDao"</span> ref<span class="token operator">=</span><span class="token string">"accountDao"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">></span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>bean<span class="token operator">></span>
  <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>配置Dao对象<span class="token operator">--</span><span class="token operator">></span>
  <span class="token operator">&lt;</span>bean id<span class="token operator">=</span><span class="token string">"accountDao"</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"com.Yogaguo.dao.ipml.AccountDaoImpl"</span><span class="token operator">></span>
      <span class="token operator">&lt;</span>property name<span class="token operator">=</span><span class="token string">"runner"</span> ref<span class="token operator">=</span><span class="token string">"runner"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">></span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>bean<span class="token operator">></span>
  <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>配置runner对象<span class="token operator">--</span><span class="token operator">></span>
  <span class="token operator">&lt;</span>bean id<span class="token operator">=</span><span class="token string">"runner"</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"org.apache.commons.dbutils.QueryRunner"</span> scope<span class="token operator">=</span><span class="token string">"prototype"</span><span class="token operator">></span>
      <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>注入数据源<span class="token operator">--</span><span class="token operator">></span>
      <span class="token operator">&lt;</span>constructor<span class="token operator">-</span>arg name<span class="token operator">=</span><span class="token string">"ds"</span> ref<span class="token operator">=</span><span class="token string">"datasource"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>constructor<span class="token operator">-</span>arg<span class="token operator">></span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>bean<span class="token operator">></span>
  <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>配置数据源<span class="token operator">--</span><span class="token operator">></span>
  <span class="token operator">&lt;</span>bean id<span class="token operator">=</span><span class="token string">"datasource"</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"com.mchange.v2.c3p0.ComboPooledDataSource"</span><span class="token operator">></span>
      <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>连接数据库的必备信息<span class="token operator">--</span><span class="token operator">></span>
      <span class="token operator">&lt;</span>property name<span class="token operator">=</span><span class="token string">"driverClass"</span> value<span class="token operator">=</span><span class="token string">"com.mysql.jdbc.Driver"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">></span>
      <span class="token operator">&lt;</span>property name<span class="token operator">=</span><span class="token string">"jdbcUrl"</span> value<span class="token operator">=</span><span class="token string">"jdbc:mysql://localhost:3306/day14"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">></span>
      <span class="token operator">&lt;</span>property name<span class="token operator">=</span><span class="token string">"user"</span> value<span class="token operator">=</span><span class="token string">"root"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">></span>
      <span class="token operator">&lt;</span>property name<span class="token operator">=</span><span class="token string">"password"</span> value<span class="token operator">=</span><span class="token string">"123456"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">></span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>bean<span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>beans<span class="token operator">></span> </code></pre>
</li>
<li><p>测试  </p>
<pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">/**
 * 使用Junit单元测试，测试配置
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AccountServiceTest</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">/**
     * 获取容器
     */</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span>  <span class="token function">testfindAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">/**
         * 获取容器
         */</span>
        ApplicationContext ac <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ClassPathXmlApplicationContext</span><span class="token punctuation">(</span><span class="token string">"bean.xml"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">//得到业务层对象</span>
        IAccountService accountService <span class="token operator">=</span><span class="token punctuation">(</span>IAccountService<span class="token punctuation">)</span> ac<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token string">"accountService"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        List<span class="token operator">&lt;</span>Account<span class="token operator">></span> allAccount <span class="token operator">=</span> accountService<span class="token punctuation">.</span><span class="token function">findAllAccount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span>Account account <span class="token operator">:</span> allAccount<span class="token punctuation">)</span><span class="token punctuation">{</span>
            System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>account<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span></code></pre>
</li>
</ul>
<h3 id="基于注解的-IOC-配置"><a href="#基于注解的-IOC-配置" class="headerlink" title="基于注解的 IOC 配置"></a><strong>基于注解的 IOC 配置</strong></h3><ul>
<li><p>学习基于注解的 IoC 配置须清楚，即注解配置和 xml 配置要实现的功能都是一样 ，的，都是要降低程序间的耦合。只是配置的形式不一样  </p>
</li>
<li><p><strong>注意 当我们使用注解注入时，set 方法不用写</strong></p>
</li>
<li><p>基于注解整合时，导入约束时需要多导入一个 context 名称空间下的约束 </p>
<img src="/2020/02/14/Demo2020-02-13blog/img02.png"> 

<p><a href="https://docs.spring.io/spring-framework/docs/current/spring-framework-reference/core.html" target="_blank" rel="noopener">约束地址</a></p>
<pre class=" language-java"><code class="language-java"><span class="token operator">&lt;</span><span class="token operator">?</span>xml version<span class="token operator">=</span><span class="token string">"1.0"</span> encoding<span class="token operator">=</span><span class="token string">"UTF-8"</span><span class="token operator">?</span><span class="token operator">></span>
<span class="token operator">&lt;</span>beans xmlns<span class="token operator">=</span><span class="token string">"http://www.springframework.org/schema/beans"</span>
       xmlns<span class="token operator">:</span>xsi<span class="token operator">=</span><span class="token string">"http://www.w3.org/2001/XMLSchema-instance"</span>
       xmlns<span class="token operator">:</span>context<span class="token operator">=</span><span class="token string">"http://www.springframework.org/schema/context"</span>
       xsi<span class="token operator">:</span>schemaLocation<span class="token operator">=</span>"http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>www<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>org<span class="token operator">/</span>schema<span class="token operator">/</span>beans
        http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>www<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>org<span class="token operator">/</span>schema<span class="token operator">/</span>beans<span class="token operator">/</span>spring<span class="token operator">-</span>beans<span class="token punctuation">.</span>xsd
        http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>www<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>org<span class="token operator">/</span>schema<span class="token operator">/</span>context
        http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>www<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>org<span class="token operator">/</span>schema<span class="token operator">/</span>context<span class="token operator">/</span>spring<span class="token operator">-</span>context<span class="token punctuation">.</span>xsd"<span class="token operator">></span>

   <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>告诉spring，在创建容器时，要扫描的包，配置所需的标签不是在beans约束里，而是在一个
      名称为context名称空间和约束中
      <span class="token operator">--</span><span class="token operator">></span>
    <span class="token operator">&lt;</span>context<span class="token operator">:</span>component<span class="token operator">-</span>scan base<span class="token operator">-</span><span class="token keyword">package</span><span class="token operator">=</span><span class="token string">"com.item"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>context<span class="token operator">:</span>component<span class="token operator">-</span>scan<span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>beans<span class="token operator">></span></code></pre>
</li>
</ul>
<h4 id="常用注解介绍"><a href="#常用注解介绍" class="headerlink" title="常用注解介绍"></a><strong>常用注解介绍</strong></h4><ul>
<li><p><strong>账户层实现类曾经的xml配置</strong></p>
<pre><code> &lt;bean id=&quot;accountService&quot; class=&quot;com.item.service.AccountServiceImpl&quot;
   scope=&quot;&quot; init-method=&quot;&quot; destroy-method=&quot;&quot;&gt;
   &lt;property name=&quot;&quot; value=&quot;&quot;/ ref=&quot;&quot;&gt;&lt;/property&gt;
       &lt;/bean&gt;  </code></pre></li>
<li><p>用于创建对象的注解<br> 它们的作用就和在xml中编写<bean></bean>标签一样<br>  <strong>@Component</strong>:</p>
<pre><code>  作用：把当前类存入spring容器中
  属性：value,用于指定bean的id,当我们不写时，默认值为当前类型，且首字母改写</code></pre></li>
<li><p><strong>@Service</strong> ：一般用于表现层<br> <strong>@Controller</strong>：一般用于业务层<br> <strong>@Repository</strong> :一般用于持久层<br> 以上三个注解的作用和属性和<strong>@Component</strong>一样，它们三个是spring 提供的明确的三层使用的注解使我们的三层对象更加清晰</p>
</li>
<li><p>用于注入数据的注解<br>它们的作用就和在<bean></bean>中编写<proterty></proterty>标签一样<br><strong>@Autowired</strong>:<br>自动按照类型注入，只要容器中有唯一的一个bean对象类型和要注入的变量类型匹配，就可以注  入成功，出现的位置可以在变量上，也可以在方法上 ,<strong>注意</strong>：在使用注解时，set方法就不是必须的了  </p>
<img src="/2020/02/14/Demo2020-02-13blog/img03.png"> 
</li>
<li><p><strong>@Qualifier</strong><br>在按照类型注入的基础上，在按照名称注入，在给类成员注入时，不能单独使用!!!但是在给方法参数注入时可以<br>属性：value 用于指定注入bean的id  </p>
</li>
</ul>
<ul>
<li><p><strong>@Resource</strong><br>直接按照bean的id注入，可以独立使用。<br>属性：name 用于指定注入bean的id<br>   <strong>以上三个注解都只能注入其他bean类型的数据，而基本类型和String类型都无法使用注解实现</strong><br><strong>另外，集合类型的注入只能通过xml实现</strong></p>
</li>
<li><p>代码示例    </p>
<ul>
<li>业务层<pre><code>@Component
public class AccountServiceImpl implements IAccountService {
@Autowired
private IAccountDao accountDao;
public void saveAccount() {
   accountDao.saveAccount();
}
}</code></pre></li>
<li>Dao 层  </li>
</ul>
</li>
</ul>
<pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>item<span class="token punctuation">.</span>dao<span class="token punctuation">;</span>

<span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span>Repository<span class="token punctuation">;</span>

<span class="token annotation punctuation">@Repository</span><span class="token punctuation">(</span><span class="token string">"accountDao"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AccountDaoImpl</span> <span class="token keyword">implements</span> <span class="token class-name">IAccountDao</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">saveAccount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"保存了账户"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<ul>
<li>测试  </li>
</ul>
<pre class=" language-java"><code class="language-java">
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">/**
     * 获取核心容器对象
      */</span>
    ApplicationContext ac <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ClassPathXmlApplicationContext</span><span class="token punctuation">(</span><span class="token string">"bean.xml"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">/**
     * 根据id获取Bean对象
     */</span>
    IAccountService as <span class="token operator">=</span><span class="token punctuation">(</span>IAccountService<span class="token punctuation">)</span> ac<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token string">"accountServiceImpl"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    as<span class="token punctuation">.</span><span class="token function">saveAccount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<ul>
<li>运行结果  <pre><code>保存了账户</code></pre></li>
</ul>
<ul>
<li><strong>@Value</strong><br>直接按照 Bean 的 id 注入。它也只能注入其他 bean 类型。<br>属性：name：指定 bean 的 id。  </li>
</ul>
<h3 id="spring-的纯注解配置"><a href="#spring-的纯注解配置" class="headerlink" title="spring 的纯注解配置"></a><strong>spring 的纯注解配置</strong></h3><ul>
<li><p>基于注解的 IoC 配置已经完成,我们依然离不开 spring 的 xml 配 置文件，那么能不能不写这个 bean.xml，所有配置都用注解来实现呢？</p>
</li>
<li><p>我们发现，之所以我们现在离不开 xml 配置文件，是因为我们有一句很关键的配置： </p>
<!-- 告知spring框架在，读取配置文件，创建容器时，扫描注解，依据注解创建对象，并存入容器中 --> 

<p>&lt;context:component-scan base-package=*”com.itheima”*&gt; </p>
<p>如果他要也能用注解配置，那么我们就离脱离 xml 文件又进了一步。  </p>
</li>
</ul>
<h4 id="新注解说明"><a href="#新注解说明" class="headerlink" title="新注解说明"></a>新注解说明</h4><ul>
<li><p><strong>@Configuration</strong><br>用于指定当前类是一个 spring 配置类，当创建容器时会从该类上加载注解。获取容器时需要使用 AnnotationApplicationContext(有@Configuration 注解的类.class)。<br>属性：<br>value:用于指定配置类的字节码  </p>
</li>
<li><p><strong>@ComponentScans</strong> :</p>
<p>用于通过注解指定spring在创建容器时要扫描的包 属性：values:它和basePackages作用一样都是用于在创建容器时要扫描的包，等同于 &lt;context:component-scan base-package=”com.Yogaguo”&gt;&gt;</p>
</li>
<li><p><strong>@Bean</strong> :<br>用于把当前方法的返回值作为bean对象存入Ioc容器中</p>
<pre><code>  属性：name 指定bean的 id ;,默认值为当前方法的名称</code></pre><p>当我们使用注解时，如果方法有参数，spring会去容器中找有没有可用的bean对象查找的方Autowired一样</p>
<ul>
<li><strong>@import</strong>: </li>
</ul>
<p>用于导入其他配置类</p>
<p>属性：value :用于指定其他配置类的字节码，当使用Import注解之后，有Import注解的类就是父配置类</p>
<ul>
<li><p><strong>@ProperySource</strong>:</p>
<p>用于指定properties文件的位置</p>
<p>属性:value,指定文件的名称和路径 关键字：classpath，表示类路径下  </p>
</li>
</ul>
</li>
</ul>
<h4 id="代码示例"><a href="#代码示例" class="headerlink" title="代码示例"></a>代码示例</h4><ul>
<li><p>编写数据库配置JdbcConfig.properties文件，放到resources下</p>
<pre class=" language-xml"><code class="language-xml">driver=com.mysql.jdbc.Driver
JdbcUrl=jdbc:mysql://localhost:3306/day14
Jdbc.name=root
password=123456</code></pre>
</li>
<li><p>编写JdbcCongif类  </p>
<pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>Yogaguo<span class="token punctuation">.</span>config<span class="token punctuation">;</span>
<span class="token keyword">import</span> com<span class="token punctuation">.</span>mchange<span class="token punctuation">.</span>v2<span class="token punctuation">.</span>c3p0<span class="token punctuation">.</span>ComboPooledDataSource<span class="token punctuation">;</span>
<span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>dbutils<span class="token punctuation">.</span>QueryRunner<span class="token punctuation">;</span>
<span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>Value<span class="token punctuation">;</span>
<span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>Bean<span class="token punctuation">;</span>
<span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>Scope<span class="token punctuation">;</span>

<span class="token keyword">import</span> javax<span class="token punctuation">.</span>sql<span class="token punctuation">.</span>DataSource<span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JdbcConfig</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span> <span class="token string">"${driver}"</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> String driver<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"${JdbcUrl}"</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> String JdbcUrl<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"${Jdbc.name}"</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> String username<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"${password}"</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> String password<span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">/**
         * 创建QueryRunner对象
         * @param dataSource
         * @return
         */</span>
        <span class="token annotation punctuation">@Bean</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"runner"</span><span class="token punctuation">)</span>
        <span class="token annotation punctuation">@Scope</span><span class="token punctuation">(</span><span class="token string">"prototype"</span><span class="token punctuation">)</span>
        <span class="token keyword">public</span> QueryRunner <span class="token function">createQueryRunner</span><span class="token punctuation">(</span>DataSource dataSource<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">QueryRunner</span><span class="token punctuation">(</span>dataSource<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
       <span class="token comment" spellcheck="true">/**
       * 创建数据源对象
       * @return
       */</span>
      <span class="token annotation punctuation">@Bean</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"dataSource"</span><span class="token punctuation">)</span>
      <span class="token keyword">public</span> DataSource <span class="token function">createDataSourece</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
          ComboPooledDataSource ds <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ComboPooledDataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">try</span> <span class="token punctuation">{</span>
              ds<span class="token punctuation">.</span><span class="token function">setDriverClass</span><span class="token punctuation">(</span>driver<span class="token punctuation">)</span><span class="token punctuation">;</span>
              ds<span class="token punctuation">.</span><span class="token function">setJdbcUrl</span><span class="token punctuation">(</span>JdbcUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>
              ds<span class="token punctuation">.</span><span class="token function">setUser</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span><span class="token punctuation">;</span>
              ds<span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span>password<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span><span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span><span class="token punctuation">{</span>
              e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
          <span class="token keyword">return</span> ds<span class="token punctuation">;</span>
      <span class="token punctuation">}</span> </code></pre>
</li>
<li><p>编写主配置类</p>
<pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@ComponentScan</span><span class="token punctuation">(</span>basePackages <span class="token operator">=</span> <span class="token string">"com.Yogaguo"</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Import</span><span class="token punctuation">(</span>JdbcConfig<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@PropertySource</span><span class="token punctuation">(</span><span class="token string">"classpath:jdbcConfig.properties"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SpringConfiguration</span> <span class="token punctuation">{</span>
  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span></code></pre>
</li>
<li><p><strong>6</strong> <strong>通过注解获取容器：</strong></p>
<pre class=" language-java"><code class="language-java">ApplicationContext ac <span class="token operator">=</span> 
<span class="token keyword">new</span> <span class="token class-name">AnnotationConfigApplicationContext</span><span class="token punctuation">(</span>SpringConfiguration<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
</li>
</ul>
<h4 id="整合Junit"><a href="#整合Junit" class="headerlink" title="整合Junit"></a><strong>整合Junit</strong></h4><ul>
<li><p>在测试类中，每个测试方法都有以下两行代码：<br>ApplicationContext ac = new ClassPathXmlApplicationContext(“bean.xml”);<br>IAccountService as = ac.getBean(“accountService”,IAccountService.class);<br>这两行代码的作用是获取容器，如果不写的话，直接会提示空指针异常。所以又不能轻易删掉。针对上述问题，我们需要的是程序能自动帮我们创建容器。一旦程序能自动为我们创建 spring 容器，我们就无须手动创建了，问题也就解决了。我们需要依靠 spring 框架，因为它提供了一个运行器，可以读取配置文件（或注解）来创建容器。我们只需要告诉它配置文件在哪就行了。</p>
</li>
<li><p>1 导入spring 整合Junit的jar</p>
</li>
<li><p>2<strong>@RunWith</strong> 使用Junit提供的注解把原有的main方法替换了，替换成spring提供的</p>
</li>
<li><p>3  告知spring的运行器，spring的Ioc创建是基于xml还是注解，并且说明位置  </p>
<ul>
<li><p><strong>@ContextConfiguration</strong>:          </p>
</li>
<li><p>属性：location :指定xml文件位置，加上classpath关键字，表示类路径    classes:指定注解类所在位置</p>
</li>
<li><p><strong>注意！！！！当使用spring5.0版本时，要求Junit为4.12及以上</strong></p>
</li>
</ul>
</li>
</ul>
<pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@RunWith</span><span class="token punctuation">(</span>SpringJUnit4ClassRunner<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@ContextConfiguration</span><span class="token punctuation">(</span>classes <span class="token operator">=</span> SpringConfiguration<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AccountServiceTest</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> IAccountService accountService<span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">/**
     * 获取容器
     */</span>
   <span class="token comment" spellcheck="true">/* @Before
    public void init(){
        ac = new AnnotationConfigApplicationContext(SpringConfiguration.class);
        accountService = (IAccountService)ac.getBean("accountService");
    }*/</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span>  <span class="token function">testfindAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        List<span class="token operator">&lt;</span>Account<span class="token operator">></span> allAccount <span class="token operator">=</span> accountService<span class="token punctuation">.</span><span class="token function">findAllAccount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span>Account account <span class="token operator">:</span> allAccount<span class="token punctuation">)</span><span class="token punctuation">{</span>
            System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>account<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span>  <span class="token function">testfindAllOne</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        Account accouuntById <span class="token operator">=</span> accountService<span class="token punctuation">.</span><span class="token function">findAccouuntById</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>accouuntById<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span>  <span class="token function">testSave</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        Account account <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Account</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        account<span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token string">"111"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        account<span class="token punctuation">.</span><span class="token function">setUsername</span><span class="token punctuation">(</span><span class="token string">"test"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          accountService<span class="token punctuation">.</span><span class="token function">saveAccount</span><span class="token punctuation">(</span>account<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span></code></pre>
<h3 id="推荐"><a href="#推荐" class="headerlink" title="推荐"></a>推荐</h3>  <a href="/2020/02/14/Demo2020-02-14blog/" title="Spring基础学习01">Spring基础学习01</a>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://Yogaguo.github.io/2020/02/14/Demo2020-02-14blog/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="小鱼儿">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="小鱼儿的技术博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2020/02/14/Demo2020-02-14blog/" itemprop="url">
                  Spring基础学习01
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-02-14T13:02:02+08:00">
                2020-02-14
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/spring基础学习/" itemprop="url" rel="index">
                    <span itemprop="name">spring基础学习</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="Spring概述"><a href="#Spring概述" class="headerlink" title="Spring概述"></a>Spring概述</h3><p>Spring 是分层的 Java SE/EE 应用 full-stack 轻量级开源框架，以 IoC（Inverse Of Control： </p>
<p>反转控制）和 AOP（Aspect Oriented Programming：面向切面编程）为内核，提供了展现层 Spring  </p>
<p>MVC 和持久层 Spring JDBC 以及业务层事务管理等众多的企业级应用技术，还能整合开源世界众多 </p>
<p>著名的第三方框架和类库。  </p>
<h4 id="优势"><a href="#优势" class="headerlink" title="优势"></a>优势</h4><ul>
<li><p><strong>方便解耦，简化开发</strong>  </p>
<p>通过 Spring 提供的 IoC 容器，可以将对象间的依赖关系交由 Spring 进行控制,，避免程序耦合。用户也不必再为单   例模式类、属性文件解析等这些很底层的需求编写代码，可以更专注于上层的应用 .  </p>
</li>
<li><p><strong>AOP 编程的支持</strong>  </p>
<p>通过 Spring 的 AOP 功能，方便进行面向切面的编程  </p>
</li>
<li><p><strong>声明式事务的支持</strong>   </p>
<p>通过声明式方式灵活的进行事务的管理,提高开发效率和质量   </p>
</li>
<li><p><strong>方便集成各种优秀框架</strong>  </p>
</li>
</ul>
<h3 id="IoC-的概念和作用"><a href="#IoC-的概念和作用" class="headerlink" title="IoC 的概念和作用"></a><strong>IoC</strong> <strong>的概念和作用</strong></h3><h4 id="程序的耦合和解耦"><a href="#程序的耦合和解耦" class="headerlink" title="程序的耦合和解耦"></a><strong>程序的耦合和解耦</strong></h4><ul>
<li><p><strong>耦合性</strong>  </p>
<p>在软件工程中，耦合指的就是就是对象之间的依赖性。对象之间的耦合越高，维护成本越高。因此对象的设计 </p>
<p>应使类和构件之间的耦合最小。软件设计中通常用耦合度和内聚度作为衡量模块独立程度的标准。<strong>划分模块的一个</strong> </p>
<p><strong>准则就是高内聚低耦合。</strong>   </p>
</li>
<li><p>代码示例  </p>
<pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AccountServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">IAccountService</span> <span class="token punctuation">{</span>
<span class="token keyword">private</span> IAccountDao accountDao <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AccountDaoImpl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
业务层调用持久层，并且此时业务层在依赖持久层的接口和实现类。如果此时没有持久层实现类，编译将不能通过。这种编译期依赖关系，应该在我们开发中杜绝。我们需要优化代码解决。 </code></pre>
</li>
</ul>
<ul>
<li><p>示例2  </p>
<pre class=" language-java"><code class="language-java">早期我们的 JDBC 操作，注册驱动时，我们为什么不使用 DriverManager 的 register 方法，而是采
用 Class<span class="token punctuation">.</span>forName 的方式
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JdbcDemo1</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        Connection con <span class="token operator">=</span> null<span class="token punctuation">;</span>
        PreparedStatement preparedStatement <span class="token operator">=</span> null<span class="token punctuation">;</span>
        ResultSet resultSet <span class="token operator">=</span> null<span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            Class<span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">"com.mysql.jdbc.Driver"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
             con <span class="token operator">=</span> DriverManager<span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token string">"jdbc:mysql://localhost:3306/studentmanager"</span><span class="token punctuation">,</span> <span class="token string">"root"</span><span class="token punctuation">,</span> <span class="token string">"123456"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
             preparedStatement <span class="token operator">=</span> con<span class="token punctuation">.</span><span class="token function">prepareStatement</span><span class="token punctuation">(</span><span class="token string">"select * from user"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            resultSet <span class="token operator">=</span> preparedStatement<span class="token punctuation">.</span><span class="token function">executeQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">while</span><span class="token punctuation">(</span>resultSet<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>resultSet<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"address"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">finally</span><span class="token punctuation">{</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
        <span class="token punctuation">}</span></code></pre>
<p>我们的类依赖了数据库的具体驱动类（MySQL），如果这时候更换了数据库品牌（比如 Oracle），需要 </p>
<p>修改源码来重新数据库驱动。这显然不是我们想要的。</p>
<pre class=" language-java"><code class="language-java">当是我们讲解 jdbc 时，是通过反射来注册驱动的，代码如下：
Class<span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">"com.mysql.jdbc.Driver"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//此处只是一个字符串</span></code></pre>
<p>同时，也产生了一个新的问题，mysql 驱动的全限定类名字符串是在 java 类中写死的，一旦要改还是要修改 </p>
<p>源码,解决这个问题也很简单，使用配置文件配置。</p>
</li>
</ul>
<h4 id="工厂模式解耦"><a href="#工厂模式解耦" class="headerlink" title="工厂模式解耦"></a><strong>工厂模式解耦</strong></h4><ul>
<li><p>在实际开发中我们可以把三层的对象都使用配置文件配置起来，当启动服务器应用加载的时候，让一个类中的 </p>
<p>方法通过读取配置文件，把这些对象创建出来<strong>并存起来</strong>。在接下来的使用的时候，直接拿过来用就好了。 </p>
<p>那么，这个读取配置文件，创建和获取三层对象的类就是<strong>工厂</strong>。 </p>
</li>
</ul>
<h4 id="控制反转-Inversion-Of-Control-工厂模式的落地"><a href="#控制反转-Inversion-Of-Control-工厂模式的落地" class="headerlink" title="控制反转-Inversion Of Control(工厂模式的落地)"></a>控制反转<strong>-Inversion Of Control(工厂模式的落地)</strong></h4><ul>
<li><p>由于我们是很多对象，肯定要找个集合来存。这时候有 Map 和 List 供选择，到底选 Map 还是 List 就看我们有没有查找需求。有查找需求，选 Map ，所以我们的答案就是 ，在应用加载时，创建一个 Map，用于存放三层对象。我们把这个 map 称之为<strong>容器</strong>  </p>
</li>
<li><p>工厂就是负责给我们从容器中获取指定对象的类。这时候我们获取对象的方式发生了改变，我们在获取对象时，都是采用 new 的方式。是<strong>主动</strong>的。我们获取对象时，同时跟工厂要，有工厂为我们查找或者创建对象。是<strong>被动</strong>的。</p>
<p>这种被动接收的方式获取对象的思想就是<strong>控制反转</strong>，它是 spring 框架的核心之一。这就是所谓的 “ Don`t call us,we will call you “. </p>
</li>
</ul>
<h4 id="简单实现"><a href="#简单实现" class="headerlink" title="简单实现"></a>简单实现</h4><ul>
<li><p>配置文件(properties): 以key-value形式，注意value为<strong>类的全限定类名</strong></p>
<pre class=" language-java"><code class="language-java">accountService<span class="token operator">=</span>com<span class="token punctuation">.</span>item<span class="token punctuation">.</span>service<span class="token punctuation">.</span>AccountServiceImpl
accountDao<span class="token operator">=</span>com<span class="token punctuation">.</span>item<span class="token punctuation">.</span>dao<span class="token punctuation">.</span>AccountDaoImpl
</code></pre>
</li>
<li><p><strong>创建bean工厂：为保证对象的线程安全性，设置容器为单例模式，所以 static 修饰 Map</strong></p>
<pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BeanFactory</span> <span class="token punctuation">{</span>
   <span class="token comment" spellcheck="true">//声明Properties为静态属性，</span>
   <span class="token keyword">private</span>  <span class="token keyword">static</span>  Properties pro<span class="token punctuation">;</span>
   <span class="token comment" spellcheck="true">//声明容器为静态，单例模式，在JVM加载阶段实例化，</span>
   <span class="token keyword">private</span> <span class="token keyword">static</span> Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span>Object<span class="token operator">></span> beans<span class="token punctuation">;</span>
   <span class="token keyword">static</span> <span class="token punctuation">{</span>
       <span class="token keyword">try</span> <span class="token punctuation">{</span>
           <span class="token comment" spellcheck="true">//创建Properties Object</span>
           pro <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Properties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token comment" spellcheck="true">//加载（读取）配置文件到内存</span>
           pro<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span>BeanFactory<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getResourceAsStream</span><span class="token punctuation">(</span><span class="token string">"properties"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token comment" spellcheck="true">//创建容器</span>
           beans <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token operator">&lt;</span>String<span class="token punctuation">,</span> Object<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token comment" spellcheck="true">//遍历配置文件中的key值，一一枚举出来</span>
           Enumeration<span class="token operator">&lt;</span>Object<span class="token operator">></span> keys <span class="token operator">=</span> pro<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token keyword">while</span><span class="token punctuation">(</span>keys<span class="token punctuation">.</span><span class="token function">hasMoreElements</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
               String key <span class="token operator">=</span> keys<span class="token punctuation">.</span><span class="token function">nextElement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
               <span class="token comment" spellcheck="true">//获取value</span>
               String beanPath <span class="token operator">=</span> pro<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
               <span class="token comment" spellcheck="true">//根据value(全限定类型)反射创建对象</span>
               Object values <span class="token operator">=</span> Class<span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span>beanPath<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
               <span class="token comment" spellcheck="true">//存入Map</span>
               beans<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span>values<span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token punctuation">}</span>
       <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">ExceptionInInitializerError</span><span class="token punctuation">(</span><span class="token string">"初始化错误"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
   <span class="token comment" spellcheck="true">//提供外部获取容器所管理对象的方法</span>
   <span class="token keyword">public</span> <span class="token keyword">static</span> Object <span class="token function">getBean</span><span class="token punctuation">(</span>String key<span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">return</span> beans<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<pre class=" language-java"><code class="language-java"> <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>

           IAccountService as <span class="token operator">=</span> <span class="token punctuation">(</span>IAccountService<span class="token punctuation">)</span> BeanFactory<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token string">"accountService"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>as<span class="token punctuation">)</span><span class="token punctuation">;</span>
           as<span class="token punctuation">.</span><span class="token function">saveAccount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre>
</li>
</ul>
<pre><code>  }</code></pre><pre><code>###  **使用 spring 的 IOC 解决程序耦合** 

#### **准备** **spring** **的开发包**  
- [官网](http://spring.io/)  

- [下载地址](http://repo.springsource.org/libs-release-local/org/springframework/spring)  

#### 模拟实践  

- 创建业务层和持久层接口与实现  

  ```java
  public interface IAccountDao {
      void saveAccount();
  }
  public class AccountDaoImpl implements IAccountDao {
      public void saveAccount() {
          System.out.println(&quot;保存了账户&quot;);
      }
  }

  /**
   * 业务层的接口
   */
  public interface IAccountService {

      /**
       * 模拟保存账户
       */
      void saveAccount();
  }
  **
   * 账户层实现类
   */
  public class AccountServiceImpl implements IAccountService {
      private IAccountDao accountDao = null;
      public void saveAccount() {
          accountDao.saveAccount();
      }
  }
</code></pre><ul>
<li><p><strong>第二步：在类的根路径下创建一个任意名称的</strong> <strong>xml</strong> <strong>文件(不能是中文)</strong>  </p>
<img src="/2020/02/14/Demo2020-02-14blog/img01.png">
</li>
<li><p><strong>给配置文件导入约束：</strong> <a href="/spring-framework-5.0.2.RELEASE/docs/spring-framework-reference/html5/core.html">约束</a>   </p>
  <img src="/2020/02/14/Demo2020-02-14blog/img02.png">
</li>
<li><p><strong>spring</strong> <strong>管理资源，在配置文件中配置</strong> <strong>service</strong> <strong>和</strong> <strong>dao</strong>  </p>
</li>
</ul>
<pre><code>```xml
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;       xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;       xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans        http://www.springframework.org/schema/beans/spring-beans.xsd&quot;&gt;  
    &lt;!--把对象的创建交给spring管理--&gt;  
    &lt;bean id=&quot;accountService&quot; class=&quot;com.item.service.AccountServiceImpl&quot;&gt;&lt;/bean&gt; 
    &lt;bean id=&quot;accountDao&quot; class=&quot;com.item.dao.AccountDaoImpl&quot;&gt;&lt;/bean&gt;&lt;/beans&gt;
```</code></pre><ul>
<li><p><strong>测试配置是否成功</strong>  </p>
<pre class=" language-java"><code class="language-java">  <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Client</span> <span class="token punctuation">{</span>
      <span class="token comment" spellcheck="true">/**
       * 获取spring的ioc核心容器，并根据id获取对象
       * @param args
       */</span>
      <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token comment" spellcheck="true">/**
           * 获取核心容器对象
            */</span>
          ApplicationContext ac <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ClassPathXmlApplicationContext</span><span class="token punctuation">(</span><span class="token string">"bean.xml"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token comment" spellcheck="true">/**
           * 根据id获取Bean对象
           */</span>
          IAccountService as <span class="token operator">=</span><span class="token punctuation">(</span>IAccountService<span class="token punctuation">)</span> ac<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token string">"accountService"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>as<span class="token punctuation">)</span><span class="token punctuation">;</span>
          as<span class="token punctuation">.</span><span class="token function">saveAccount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token punctuation">}</span></code></pre>
</li>
</ul>
<ul>
<li><pre class=" language-java"><code class="language-java"> ApplicationContext的三个常用实现类 
 <span class="token operator">-</span> ClassPathXmlApplicationContext
 可以加载类路径下的配置文件，要求配置文件必须类中加载；否则，加载不了
 FileSystemXmlApplicationContext      
 可以加载磁盘任意路径下的配置文件<span class="token punctuation">(</span>必须有访问权限<span class="token punctuation">)</span>
 <span class="token operator">-</span> AnnotationConfigApplicationContext 
用于读取注解，创建容器的，待议</code></pre>
<pre><code></code></pre></li>
<li><p>1 BeanFactory 和 ApplicationContext 的区别</p>
<pre><code></code></pre></li>
</ul>
<p><strong>BeanFactory 才是 Spring 容器中的顶层接口,ApplicationContext 是它的子接口。</strong></p>
<ul>
<li><p><strong>BeanFactory 和 ApplicationContext 的区别</strong>：</p>
<pre class=" language-java"><code class="language-java">  ApplicationContext：单例对象适用<span class="token operator">:</span>
  它在构建核心容器时，创建对象采用的策略是立即加载的方式，也就是说，只要一读取完配置文件，就马上创建配置文件中配置的对象。
  BeanFactory<span class="token operator">:</span> 它在构建核心容器时，创建对象采用的策略是延迟加载的方式，也就是说，什么时候根据id            获取对象了，什么时候才真正创建对象</code></pre>
</li>
</ul>
<h3 id="IOC-中-bean-标签和管理对象细节"><a href="#IOC-中-bean-标签和管理对象细节" class="headerlink" title="IOC 中 bean 标签和管理对象细节"></a>IOC 中 bean 标签和管理对象细节</h3><h4 id="spring-对bean的管理细节"><a href="#spring-对bean的管理细节" class="headerlink" title="spring 对bean的管理细节"></a>spring 对bean的管理细节</h4><ul>
<li><p>创建bean的三种方式</p>
<ul>
<li><p>第一种方式，使用默认构造方式,在spring的配置文件中，配以id和class属性之后，且没有其他属性和标签时，采用的就是默认构造函数创建bean对象，此时如果类中没有默认构造函数，对象无法创建</p>
<pre class=" language-xml"><code class="language-xml"> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>accountService<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>com.item.service.AccountServiceImpl<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span>--></code></pre>
</li>
</ul>
</li>
<li><p>第二种方式，使用普通工厂中的方法创建对象(使用某个类中的方法创建对象，并存入spring容器)</p>
<pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">InstanceFactory</span> <span class="token punctuation">{</span>
      <span class="token keyword">public</span> AccountServiceImpl <span class="token function">getAccountService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
          <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">AccountServiceImpl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

   <span class="token operator">&lt;</span>bean id<span class="token operator">=</span><span class="token string">"instanceFactory"</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"com.item.Factory.InstanceFactory"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>bean<span class="token operator">></span>
        <span class="token operator">&lt;</span>bean id<span class="token operator">=</span><span class="token string">"accountService"</span> factory<span class="token operator">-</span>bean<span class="token operator">=</span><span class="token string">"instanceFactory"</span> factory<span class="token operator">-</span>method<span class="token operator">=</span><span class="token string">"getAccountService"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>bean<span class="token operator">></span><span class="token operator">--</span><span class="token operator">></span> </code></pre>
<ul>
<li><p>第三种方式，使用即静态工厂中的方法创建对象(使用某个类中的静态方法创建对象，并存入spring容器)  </p>
<pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>item<span class="token punctuation">.</span>Factory<span class="token punctuation">;</span>

<span class="token keyword">import</span> com<span class="token punctuation">.</span>item<span class="token punctuation">.</span>service<span class="token punctuation">.</span>AccountServiceImpl<span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StaticInstanceFactory</span> <span class="token punctuation">{</span>
   <span class="token keyword">public</span> <span class="token keyword">static</span> AccountServiceImpl <span class="token function">getAccountService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
       <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">AccountServiceImpl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token operator">&lt;</span>bean id<span class="token operator">=</span><span class="token string">"accountService"</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"com.item.Factory.StaticInstanceFactory"</span> factory<span class="token operator">-</span>method<span class="token operator">=</span><span class="token string">"getAccountService"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>bean<span class="token operator">></span><span class="token operator">--</span><span class="token operator">></span>
</code></pre>
</li>
</ul>
</li>
</ul>
<h4 id="bean-作用域调整"><a href="#bean-作用域调整" class="headerlink" title="bean 作用域调整"></a>bean 作用域调整</h4><ul>
<li><p>bean标签的scope属性：用于指定bean的作用范围</p>
<pre><code>      取值：
         singleton:单例（默认值）
         prototype：多例
         request：作用于web应用的请求范围
         session：作用于web应用的会话范围
         global-session：作用于集群环境下全局会话范围，当不是集群环境时，它就是session </code></pre><p>​            init-method：指定类中的初始化方法名称。 </p>
<p>​            destroy-method：指定类中销毁方法名称。  </p>
</li>
<li><p>bean对象的生命周期  </p>
<ul>
<li>单例对象<pre><code>     出生：当容器创建时，对象出生
     存活：容器存活，对象一直存活
     死亡：容器销毁，对象销毁</code></pre><ul>
<li>多例对象<pre><code>出生：当使用对象时spring框架为我们创建
存活：对象只要是在使用过程中，就一直存活
死亡：当对象长时间不用，且没有对象引用时，GC  </code></pre></li>
</ul>
</li>
</ul>
</li>
</ul>
<pre class=" language-xml"><code class="language-xml">
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>accountService<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>com.item.service.AccountServiceImpl<span class="token punctuation">"</span></span> <span class="token attr-name">scope</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>singleton<span class="token punctuation">"</span></span>
        <span class="token attr-name">init-method</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>init<span class="token punctuation">"</span></span> <span class="token attr-name">destroy-method</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>destory<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>beans</span><span class="token punctuation">></span></span></code></pre>
<h3 id="spring的依赖注入"><a href="#spring的依赖注入" class="headerlink" title="spring的依赖注入"></a><strong>spring的依赖注入</strong></h3><p>依赖注入：<strong>Dependency injection</strong>:我们的程序在编写时，通过控制反转，把对象的创建交给了 spring，但是代码中不可能出现没有依赖的情况。<br>ioc 解耦只是降低他们的依赖关系，但不会消除。例如：我们的业务层仍会调用持久层的方法。 那这种业务层和持久层的依赖关系，在使用 spring 之后，就让 spring 来维护了。 简单的说，就是坐等框架把持久层对象传入业务层，而不用我们自己去获取。<br>IOC的作用：降低程序间的耦合<br>       依赖关系的管理：<br>       在当前类需要用到其他类的对象，由spring为我们维护，我们只需在配置文件中说明<br>       依赖关系的维护就称之为 依赖注入<br>       依赖注入的数据，有三类<br>          1 基本数据类型和String<br>          2 其他bean类型（在配置文件中注解配置过的bean）<br>          3 复杂类型（）集合<br>       注入的方式，3种<br>          1 构造方法提供<br>          2 set方法<br>          3 注解提供  </p>
<h4 id="构造方法注入"><a href="#构造方法注入" class="headerlink" title="构造方法注入"></a>构造方法注入</h4><p>使用的标签：constructor - arg<br>    标签属性：<br>        type ；用于指定要注入的数据类型，该数据类型也是构造方法中某些参数的类型<br>        index:用于指定要注入的数据给构造方法中的指定索引位置的参数赋值，参置从开始<br>        name:<strong>用于给构造方法中指定名称的参数赋值   常用！！！！</strong><br>          以上3个用于指定给构造方法中哪个参数赋值<br>        value:用于提供基本类型和String类型的数据<br>       ref:指定其他bean类型数据，即在spring 的Ioc核心容器中出现的bean对象  </p>
<p> 优势：在获取bean对象时，注入数据是必须的操作，否则对象无法创建<br> 弊端：改变了bean对象的实例化方式，使我们在创建对象时，即使用不到这些数据，也必须提供！  </p>
<pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AccountServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">IAccountService</span> <span class="token punctuation">{</span>
     <span class="token keyword">private</span> String str<span class="token punctuation">;</span>
     <span class="token keyword">private</span> Integer age<span class="token punctuation">;</span>
     <span class="token keyword">private</span> Date time<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token function">AccountServiceImpl</span><span class="token punctuation">(</span>String str<span class="token punctuation">,</span> Integer age<span class="token punctuation">,</span> Date time<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>str <span class="token operator">=</span> str<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">=</span> age<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>time <span class="token operator">=</span> time<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">saveAccount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"service中的saveAccount执行了。。。"</span><span class="token operator">+</span>str<span class="token operator">+</span><span class="token string">","</span><span class="token operator">+</span>age<span class="token operator">+</span><span class="token string">","</span><span class="token operator">+</span>time<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
  <span class="token operator">&lt;</span>bean id<span class="token operator">=</span><span class="token string">"accountService"</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"com.item.service.AccountServiceImpl"</span> <span class="token operator">></span>
        <span class="token operator">&lt;</span>constructor<span class="token operator">-</span>arg name<span class="token operator">=</span><span class="token string">"str"</span> value<span class="token operator">=</span><span class="token string">"test"</span> <span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>constructor<span class="token operator">-</span>arg<span class="token operator">></span>
        <span class="token operator">&lt;</span>constructor<span class="token operator">-</span>arg name<span class="token operator">=</span><span class="token string">"age"</span> value<span class="token operator">=</span><span class="token string">"18"</span> <span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>constructor<span class="token operator">-</span>arg<span class="token operator">></span>
        <span class="token operator">&lt;</span>constructor<span class="token operator">-</span>arg name<span class="token operator">=</span><span class="token string">"time"</span> ref<span class="token operator">=</span><span class="token string">"now"</span> <span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>constructor<span class="token operator">-</span>arg<span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>bean<span class="token operator">></span>

    <span class="token operator">&lt;</span>bean id<span class="token operator">=</span><span class="token string">"now"</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"java.util.Date"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>bean<span class="token operator">></span>

</code></pre>
<ul>
<li><p>测试  </p>
<pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">/**
         * 获取核心容器对象
          */</span>
        ApplicationContext ac <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ClassPathXmlApplicationContext</span><span class="token punctuation">(</span><span class="token string">"bean.xml"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">/**
         * 根据id获取Bean对象
         */</span>
        IAccountService as <span class="token operator">=</span><span class="token punctuation">(</span>IAccountService<span class="token punctuation">)</span> ac<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token string">"accountService"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        as<span class="token punctuation">.</span><span class="token function">saveAccount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

结果：
service中的saveAccount执行了。。。test<span class="token punctuation">,</span><span class="token number">18</span><span class="token punctuation">,</span>Fri Feb <span class="token number">14</span> <span class="token number">15</span><span class="token operator">:</span><span class="token number">06</span><span class="token operator">:</span><span class="token number">18</span> CST <span class="token number">2020</span></code></pre>
</li>
</ul>
<h4 id="set方法注入-常用！！！"><a href="#set方法注入-常用！！！" class="headerlink" title="set方法注入      常用！！！"></a>set方法注入      <strong>常用！！！</strong></h4><p> 涉及的标签：<strong>property</strong><br>       属性：<br>         name:注入时所调用的set方法名称<br>         value:用于提供基本类型和String类型的数据<br>         ref:指定其他bean类型数据，即在spring 的Ioc核心容器中出现的bean对象  </p>
<p>​      优势：创建对象时没有明确的限制，可以直接使用默认构造方法<br>​      弊端：如果有某个成员必须有值。获取对象时set方法有可能没有指向</p>
<pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AccountServiceImpl2</span> <span class="token keyword">implements</span> <span class="token class-name">IAccountService</span> <span class="token punctuation">{</span>
     <span class="token keyword">private</span> String str<span class="token punctuation">;</span>
     <span class="token keyword">private</span> Integer age<span class="token punctuation">;</span>
     <span class="token keyword">private</span> Date time<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setStr</span><span class="token punctuation">(</span>String str<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>str <span class="token operator">=</span> str<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setAge</span><span class="token punctuation">(</span>Integer age<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">=</span> age<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setTime</span><span class="token punctuation">(</span>Date time<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>time <span class="token operator">=</span> time<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">saveAccount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"service中的saveAccount执行了。。。"</span><span class="token operator">+</span>str<span class="token operator">+</span><span class="token string">","</span><span class="token operator">+</span>age<span class="token operator">+</span><span class="token string">","</span><span class="token operator">+</span>time<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
 <span class="token operator">&lt;</span>bean id<span class="token operator">=</span><span class="token string">"accountService2"</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"com.item.service.AccountServiceImpl2"</span> <span class="token operator">></span>
        <span class="token operator">&lt;</span>property name<span class="token operator">=</span><span class="token string">"str"</span> value<span class="token operator">=</span><span class="token string">"Yogaguo"</span> <span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">></span>
        <span class="token operator">&lt;</span>property name<span class="token operator">=</span><span class="token string">"age"</span> value<span class="token operator">=</span><span class="token string">"18"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">></span>
        <span class="token operator">&lt;</span>property name<span class="token operator">=</span><span class="token string">"time"</span> ref<span class="token operator">=</span><span class="token string">"now"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>bean<span class="token operator">></span>

</code></pre>
<h4 id="复杂类型的注入-集合类型的注入"><a href="#复杂类型的注入-集合类型的注入" class="headerlink" title="复杂类型的注入(集合类型的注入)"></a>复杂类型的注入(集合类型的注入)</h4><p>  用于给List结构集合类型的注入的标签<br>     list array set<br>    用于给Map结构集合类型的注入的标签<br>    map props<br>    结构相似，标签可以互换  </p>
<pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>item<span class="token punctuation">.</span>service<span class="token punctuation">;</span>


<span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>*<span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">/**
 * 账户层实现类
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AccountServiceImpl3</span> <span class="token keyword">implements</span> <span class="token class-name">IAccountService</span> <span class="token punctuation">{</span>

     <span class="token keyword">private</span> String<span class="token punctuation">[</span><span class="token punctuation">]</span> strings<span class="token punctuation">;</span>
     <span class="token keyword">private</span> List<span class="token operator">&lt;</span>String<span class="token operator">></span> list<span class="token punctuation">;</span>
     <span class="token keyword">private</span> Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span>String<span class="token operator">></span> map<span class="token punctuation">;</span>
     <span class="token keyword">private</span> Properties properties<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setStrings</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> strings<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>strings <span class="token operator">=</span> strings<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setList</span><span class="token punctuation">(</span>List<span class="token operator">&lt;</span>String<span class="token operator">></span> list<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>list <span class="token operator">=</span> list<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setMap</span><span class="token punctuation">(</span>Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> String<span class="token operator">></span> map<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>map <span class="token operator">=</span> map<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setProperties</span><span class="token punctuation">(</span>Properties properties<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>properties <span class="token operator">=</span> properties<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">saveAccount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>Arrays<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>strings<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>list<span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>map<span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>properties<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
<span class="token operator">&lt;</span>bean id<span class="token operator">=</span><span class="token string">"accountService3"</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"com.item.service.AccountServiceImpl3"</span><span class="token operator">></span>
        <span class="token operator">&lt;</span>property name<span class="token operator">=</span><span class="token string">"strings"</span><span class="token operator">></span>
            <span class="token operator">&lt;</span>array<span class="token operator">></span>
                <span class="token operator">&lt;</span>value<span class="token operator">></span>aaa<span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">></span>
                <span class="token operator">&lt;</span>value<span class="token operator">></span>bbb<span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">></span>
                <span class="token operator">&lt;</span>value<span class="token operator">></span>ccc<span class="token operator">&lt;</span><span class="token operator">/</span>value<span class="token operator">></span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>array<span class="token operator">></span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>property<span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>bean<span class="token operator">></span></code></pre>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://Yogaguo.github.io/2020/02/11/demo2020-02-11/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="小鱼儿">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="小鱼儿的技术博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2020/02/11/demo2020-02-11/" itemprop="url">
                  SQL语句是如何执行的?
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-02-11T18:38:40+08:00">
                2020-02-11
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/mysql/" itemprop="url" rel="index">
                    <span itemprop="name">mysql</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="MySQL逻辑架构"><a href="#MySQL逻辑架构" class="headerlink" title="MySQL逻辑架构"></a>MySQL逻辑架构</h3><ul>
<li><p>首先头脑中构建一副MySQL个组件是如何协同工作,MySQL最与众不同的地方在于它的存储引擎架构，这种架构的设计将查询处理(Query Processing)及其他系统任务(Server Task)和数据的存储 / 提取分离。更加高效。<br>下面是MySQL的基本架构示意图，从这里可以看出SQL语句在各个组件间的执行过程  </p>
  <img src="/2020/02/11/demo2020-02-11/mysql.png">
</li>
<li><p>最上层并不是MySQL独有的，大多数基于网络的客户端 / 服务器的工具或者服务都有相似的架构，比如连接处理  授权认证。。。。  </p>
</li>
</ul>
<p>  第二次是MySQL的核心服务功能区(Server),包括连接器，查询缓存  分析器  优化器 ，执行器等待核心服务功能，以及所有的内置函数（日期，时间 数学加密),还有所有跨存储引擎的功能都在这一次实现，比如存储过程，触发器，视图等，还有一个通用的日志模块 binglog日志模块。  </p>
<p>  第三次包含了存储引擎。存储引擎负责数据的存储和提取。架构是插件式的。支持InnoDB,MyISAM,Memory多个存储引擎,其中InnoDB引擎有日志模块redolog 模块。  </p>
<p>  当执行建表的时候，如果不指定引擎类型，默认使用的就是InnoDB,当然，也可以通过指定引擎的类型选择，在 create table语句中用engine=memory来指定。<br>  如图所示，不同的存储引擎公用一个<strong>Server层</strong></p>
<ul>
<li><code>select * from student where id=10;</code></li>
</ul>
<h4 id="连接器"><a href="#连接器" class="headerlink" title="连接器"></a>连接器</h4><p>第一步会先里连接数据库，<strong>连接器会负责和客户端建立连接，获取权限，维持和管理连接</strong>。如果用户账户密码已通过，连接器会到权限表中查询该用户的所有权限，之后在这个连接里的权限逻辑判断都是会依赖此时读取到的权限数据，也就是说在成功连接后，即使用管理员账号对这个用户权限做了修改，也不会影响已经存在的连接的权限，该用户不受影响的。在连接完成后，如果用户没有后序动作，这个连接就处于空闲态，如果<strong>长时间</strong>客户端没动静，连接器会自动断开，这时间由参数wait_timeout决定，默认8h.  </p>
<p>在连接断开后，下一次需要重连，在数据库中有长连接，短连接，前者指连接成功后，客户端持续有请求，则一直使用此连接，后者指每次执行很少的查询后就断开连接。下次再次连接。<strong>建立连接是比较耗时的，所以尽量减少建立连接动作，尽量使用长连接，但是全部使用长连接，MySQL内存涨的很快，因为MySQL执行中临时使用的内存是管理在连接对象里，它们只能在连接断开时被释放，所以长期连接积累下来，内存越来越大，最后OOM，MySQL就会异常Restart</strong>。建议使用一段时间后执行 mysql_reset_connection初始化连接资源。会直接恢复到刚刚创建的状态。  </p>
<h4 id="查询缓存"><a href="#查询缓存" class="headerlink" title="查询缓存"></a>查询缓存</h4><p>连接建立后，执行查询语句的时候，会先查询缓存，Mysql会先校验这个sql是否执行过，以Key-Value的形式缓存在内存中，Key是查询语句，Value是查询的结果。如果缓存key被命中，就会直接返回给客户端，如果没有命中，就会执行后续的操作，完成后也会把结果缓存起来，方便下一次调用。当然在真正执行缓存查询的时候还是会校验用户的权限，是否有该表的查询条件.</p>
<p><strong>大多数情况下不建议使用查询缓存，因为往往弊大于利。</strong></p>
<p>查询缓存实现非常频繁，对一个表的更新，这个表所有的查询缓存都会被清空。Mysql 8.0 版本后删除了缓存的功能，官方也是认为该功能在实际的应用场景比较少，所以直接删掉了。  </p>
<h4 id="分析器"><a href="#分析器" class="headerlink" title="分析器"></a>分析器</h4><p>MySQL 没有命中缓存，那么就会进入分析器，分析器主要是用来分析SQL语句是做什么的，分析器也会分为几步：</p>
<ul>
<li><p>词法分析  ：分析器会识别SQL语句中的字符串分析是什么，代表什么。从你输入的”select”关键字识别出来，是一条查询语句，把字符串 “ student “ 识别为 “ 表名student “,字符串 “ id “ 识别为 “ 列id “.</p>
</li>
<li><p>语法分析：判断你输入的SQL是否正确，是否符合MySQL的语法。如果语句不对，就会出现熟悉的提示信息：”You have an error in your SQL syntax”   </p>
</li>
</ul>
<p>完成这2步之后，mysql就准备开始执行了，但是如何执行，怎么执行是最好的结果呢？这个时候就需要优化器。</p>
<h4 id="优化器"><a href="#优化器" class="headerlink" title="优化器"></a>优化器</h4><ul>
<li>优化器就是在表中有多个索引时，决定使用哪个索引，多表关联时，决定表间连接顺序，优化器根据自己的优化算法进行选择执行效率最好的一个方案。  </li>
</ul>
<h4 id="执行器"><a href="#执行器" class="headerlink" title="执行器"></a>执行器</h4><ul>
<li>在经过分析器知道要做什么，优化器知道该如何做后，进入执行器阶段。先判断此表有无查询权限，如果没有，返回错误信息。如果有权限，就打开表执行，执行器依据引擎定义，使用指定引擎interface，调用InnoDB引擎interface取表第一行，判断 id == 10 ,不是，跳到下一行，重复判断，找到后存入结果集中。</li>
</ul>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><ul>
<li><p>Mysql 主要分为Server层和引擎层，Server层主要包括连接器、查询缓存、分析器、优化器、执行器，同时还有一个日志模块（binlog），这个日志模块所有执行引擎都可以共用。</p>
<p>引擎层是插件式的，目前主要包括，MyISAM,InnoDB,Memory等。</p>
</li>
<li><p>查询语句的执行流程如下：权限校验（如果命中缓存）—》查询缓存—》分析器—》优化器—》权限校验—》执行器—》引擎</p>
</li>
</ul>
<h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><ul>
<li>《mysql专栏45讲》</li>
<li>《高性能mysql第三版》</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://Yogaguo.github.io/2019/11/19/2019-11-19/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="小鱼儿">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="小鱼儿的技术博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2019/11/19/2019-11-19/" itemprop="url">
                  Morris遍历实现二叉树的三种遍历
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-11-19T21:23:38+08:00">
                2019-11-19
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/二叉树/" itemprop="url" rel="index">
                    <span itemprop="name">二叉树</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="引入"><a href="#引入" class="headerlink" title="引入"></a>引入</h3><p>首先看一个题：给定一颗二叉树头结点，完成二叉树的先序  后序  中序 ，如果二叉树的结点数为 N ，要求时间复杂度为O(N),额外空间复杂度为O(1).</p>
<p>首先看普通的递归，其实质是使用了系统提供的函数栈；非递归的方法使用了申请的栈，两者的额外空间复杂度都与树事务高度有关，所以空间复杂度为O(h)。</p>
<p>本题要求空间复杂度为O(1),这就要求使用 Morris 遍历</p>
<h3 id="Morris遍历"><a href="#Morris遍历" class="headerlink" title="Morris遍历"></a>Morris遍历</h3><p>Morris遍历的实质就是避免使用栈结构，而是让下层到上层有指针，通过让底层结点指向 null 的空闲指针指向上层某个结点，从而完成下层到上层的移动。因为二叉树的很多结点都有大量空闲指针，比如，某些结点没有右孩子，那么这个结点的 right 指针就指向 null ,Morris遍历正是用了这些空闲指针。</p>
<p>具体流程：</p>
<ul>
<li>当前结点为 cur1,cur1无左子树，cur1向右移动，<code>cur1 = cur1.right</code></li>
<li>cur1有左子树，找左子树最右结点（mostright）<pre><code>  - mostright的右孩子为 null ,右孩子指向 cur1, cur1 向左移动
      -  mostright的右孩子为 cur,mostright的右孩子指向 null ,cur向右 cur1 = cur1.right.</code></pre></li>
</ul>
<p>总结为：在树中，对于任何一个有左子树的结点，会 2 次回到自己；没有左子树的结点，只会 1 次回到自己，整体顺序为：先回到当前结点，遍历完自己的左子树之后，再回到 cur,在遍历右子树</p>
<pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">morris</span><span class="token punctuation">(</span>Node head<span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword">if</span><span class="token punctuation">(</span> head <span class="token operator">==</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>
           <span class="token keyword">return</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span>
       Node cur1 <span class="token operator">=</span> head<span class="token punctuation">;</span>
       Node cur2 <span class="token operator">=</span> null<span class="token punctuation">;</span>
       <span class="token keyword">while</span><span class="token punctuation">(</span>cur1 <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            cur2 <span class="token operator">=</span> cur1<span class="token punctuation">.</span>left <span class="token punctuation">;</span>
           <span class="token keyword">if</span><span class="token punctuation">(</span>cur2 <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>
               <span class="token keyword">while</span><span class="token punctuation">(</span>cur2<span class="token punctuation">.</span>right <span class="token operator">!=</span> null <span class="token operator">&amp;&amp;</span> cur2<span class="token punctuation">.</span>right <span class="token operator">!=</span> cur1<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                   cur2 <span class="token operator">=</span> cur2<span class="token punctuation">.</span>right<span class="token punctuation">;</span>
               <span class="token punctuation">}</span>
               <span class="token keyword">if</span><span class="token punctuation">(</span>cur2<span class="token punctuation">.</span>right <span class="token operator">==</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                   cur2<span class="token punctuation">.</span>right <span class="token operator">=</span> cur1<span class="token punctuation">;</span>
                   cur1 <span class="token operator">=</span> cur1<span class="token punctuation">.</span>left<span class="token punctuation">;</span>
                    <span class="token keyword">continue</span><span class="token punctuation">;</span>
               <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{</span>
                  cur2<span class="token punctuation">.</span>right <span class="token operator">=</span> null<span class="token punctuation">;</span> 
               <span class="token punctuation">}</span>
           <span class="token punctuation">}</span>
           cur2 <span class="token operator">=</span> cur2<span class="token punctuation">.</span>right<span class="token punctuation">;</span>
       <span class="token punctuation">}</span>
   <span class="token punctuation">}</span></code></pre>
<h3 id="Morris实现先序遍历"><a href="#Morris实现先序遍历" class="headerlink" title="Morris实现先序遍历"></a>Morris实现先序遍历</h3><p>在Morris的基础上，只要第一次回到当前结点，即 当前结点左子树最右结点的右孩子为 null ;或者当前结点没有左子树</p>
<p>就直接打印，从而实现先序遍历</p>
<pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">morrisPre</span><span class="token punctuation">(</span>Node head<span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword">if</span><span class="token punctuation">(</span> head <span class="token operator">==</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>
           <span class="token keyword">return</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span>
       Node cur1 <span class="token operator">=</span> head<span class="token punctuation">;</span>
       Node cur2 <span class="token operator">=</span> null<span class="token punctuation">;</span>
       <span class="token keyword">while</span><span class="token punctuation">(</span>cur1 <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            cur2 <span class="token operator">=</span> cur1<span class="token punctuation">.</span>left <span class="token punctuation">;</span>
           <span class="token keyword">if</span><span class="token punctuation">(</span>cur2 <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>
               <span class="token keyword">while</span><span class="token punctuation">(</span>cur2<span class="token punctuation">.</span>right <span class="token operator">!=</span> null <span class="token operator">&amp;&amp;</span> cur2<span class="token punctuation">.</span>right <span class="token operator">!=</span> cur1<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                   cur2 <span class="token operator">=</span> cur2<span class="token punctuation">.</span>right<span class="token punctuation">;</span>
               <span class="token punctuation">}</span>
               <span class="token keyword">if</span><span class="token punctuation">(</span>cur2<span class="token punctuation">.</span>right <span class="token operator">==</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                   cur2<span class="token punctuation">.</span>right <span class="token operator">=</span> cur1<span class="token punctuation">;</span>
                   System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span>cur1<span class="token punctuation">.</span>value<span class="token operator">+</span><span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                   cur1 <span class="token operator">=</span> cur1<span class="token punctuation">.</span>left<span class="token punctuation">;</span>
                    <span class="token keyword">continue</span><span class="token punctuation">;</span>
               <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{</span>
                  cur2<span class="token punctuation">.</span>right <span class="token operator">=</span> null<span class="token punctuation">;</span> 
               <span class="token punctuation">}</span>
           <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{</span>
               System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span>cur1<span class="token punctuation">.</span>value<span class="token operator">+</span><span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token punctuation">}</span>
           cur1 <span class="token operator">=</span> cur1<span class="token punctuation">.</span>right<span class="token punctuation">;</span>
       <span class="token punctuation">}</span>
   <span class="token punctuation">}</span></code></pre>
<h3 id="Morris实现中序遍历"><a href="#Morris实现中序遍历" class="headerlink" title="Morris实现中序遍历"></a>Morris实现中序遍历</h3><p>因为中序遍历是：左中右，那么在当前结点没有左子树时，就直接打印；在当前结点有左子树的情况下，第二次回到自己时，打印，实现中序遍历。</p>
<p>我们知道，不管是没有左子树时，还是第二次回到自己时，下一步都是向右移动，所以，在代码中可以在当前结点 cur1 向右移动时打印结点</p>
<pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">morrisIn</span><span class="token punctuation">(</span>Node head<span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword">if</span><span class="token punctuation">(</span> head <span class="token operator">==</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>
           <span class="token keyword">return</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span>
       Node cur1 <span class="token operator">=</span> head<span class="token punctuation">;</span>
       Node cur2 <span class="token operator">=</span> null<span class="token punctuation">;</span>
       <span class="token keyword">while</span><span class="token punctuation">(</span>cur1 <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>
           cur2 <span class="token operator">=</span> cur1<span class="token punctuation">.</span>left<span class="token punctuation">;</span>
           <span class="token keyword">if</span><span class="token punctuation">(</span> cur2 <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>
               <span class="token keyword">while</span><span class="token punctuation">(</span>cur2<span class="token punctuation">.</span>right <span class="token operator">!=</span> null <span class="token operator">&amp;&amp;</span> cur2<span class="token punctuation">.</span>right <span class="token operator">!=</span> cur1<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                   cur2 <span class="token operator">=</span> cur2<span class="token punctuation">.</span>right<span class="token punctuation">;</span>
               <span class="token punctuation">}</span>
               <span class="token keyword">if</span><span class="token punctuation">(</span>cur2<span class="token punctuation">.</span>right <span class="token operator">==</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                   cur2<span class="token punctuation">.</span>right <span class="token operator">=</span> cur1<span class="token punctuation">;</span>
                   cur1 <span class="token operator">=</span> cur1<span class="token punctuation">.</span>left<span class="token punctuation">;</span>
                   <span class="token keyword">continue</span><span class="token punctuation">;</span>
               <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{</span>
                   cur2<span class="token punctuation">.</span>right <span class="token operator">=</span> null<span class="token punctuation">;</span>
               <span class="token punctuation">}</span>
           <span class="token punctuation">}</span>
           System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span>cur1<span class="token punctuation">.</span>value<span class="token operator">+</span><span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           cur1 <span class="token operator">=</span> cur1<span class="token punctuation">.</span>right<span class="token punctuation">;</span>
       <span class="token punctuation">}</span>
   <span class="token punctuation">}</span></code></pre>
<h3 id="Morris实现后序遍历"><a href="#Morris实现后序遍历" class="headerlink" title="Morris实现后序遍历"></a>Morris实现后序遍历</h3><p>后序遍历有点复杂，在第 2 次回到当前结点时，把左子树右边界逆序打印完后，当整个循环走完，对于整个树，在单独打印树的右遍历。</p>
<p>对于逆序，可以借助栈，不过会有额外空间额代价，这里采用 链表逆序法 reverse(head),</p>
<pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">morrisPos</span><span class="token punctuation">(</span>Node head<span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword">if</span><span class="token punctuation">(</span>head <span class="token operator">==</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>
           <span class="token keyword">return</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span>
       Node cur1 <span class="token operator">=</span> head<span class="token punctuation">;</span>
       Node cur2 <span class="token operator">=</span> null<span class="token punctuation">;</span>
       <span class="token keyword">while</span><span class="token punctuation">(</span>cur1 <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>
           cur2 <span class="token operator">=</span> cur1<span class="token punctuation">.</span>left<span class="token punctuation">;</span>
           <span class="token keyword">if</span><span class="token punctuation">(</span>cur2 <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>
               <span class="token keyword">while</span><span class="token punctuation">(</span>cur2<span class="token punctuation">.</span>right <span class="token operator">!=</span> null <span class="token operator">&amp;&amp;</span> cur2<span class="token punctuation">.</span>right <span class="token operator">!=</span> cur1<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                   cur2 <span class="token operator">=</span> cur2<span class="token punctuation">.</span>right<span class="token punctuation">;</span>
               <span class="token punctuation">}</span>
               <span class="token keyword">if</span><span class="token punctuation">(</span>cur2<span class="token punctuation">.</span>right <span class="token operator">==</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                   cur2<span class="token punctuation">.</span>right <span class="token operator">=</span> cur1<span class="token punctuation">;</span>
                   cur1 <span class="token operator">=</span> cur1<span class="token punctuation">.</span>left<span class="token punctuation">;</span>
                   <span class="token keyword">continue</span><span class="token punctuation">;</span>
               <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{</span>
                   cur2<span class="token punctuation">.</span>right <span class="token operator">=</span> null<span class="token punctuation">;</span>
                   <span class="token function">printEdge</span><span class="token punctuation">(</span>cur1<span class="token punctuation">.</span>left<span class="token punctuation">)</span><span class="token punctuation">;</span>
               <span class="token punctuation">}</span>
           <span class="token punctuation">}</span>
           cur1 <span class="token operator">=</span> cur1<span class="token punctuation">.</span>right<span class="token punctuation">;</span>
       <span class="token punctuation">}</span>
       <span class="token function">printEdge</span><span class="token punctuation">(</span>head<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
       <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">printEdge</span><span class="token punctuation">(</span>Node left<span class="token punctuation">)</span> <span class="token punctuation">{</span>
               Node cur <span class="token operator">=</span> <span class="token function">reverse</span><span class="token punctuation">(</span>left<span class="token punctuation">)</span><span class="token punctuation">;</span>
               <span class="token keyword">while</span><span class="token punctuation">(</span>cur <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                   System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span>cur<span class="token punctuation">.</span>value<span class="token operator">+</span><span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                   cur <span class="token operator">=</span> cur<span class="token punctuation">.</span>right<span class="token punctuation">;</span>
               <span class="token punctuation">}</span>

        <span class="token punctuation">}</span>
        <span class="token keyword">private</span> <span class="token keyword">static</span> Node <span class="token function">reverse</span><span class="token punctuation">(</span>Node cur<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            Node next <span class="token operator">=</span> null<span class="token punctuation">;</span>
            Node pre <span class="token operator">=</span> null<span class="token punctuation">;</span>
            <span class="token keyword">while</span><span class="token punctuation">(</span>cur <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                next <span class="token operator">=</span> cur<span class="token punctuation">.</span>right<span class="token punctuation">;</span>
                cur<span class="token punctuation">.</span>right <span class="token operator">=</span> pre<span class="token punctuation">;</span>
                pre <span class="token operator">=</span> cur<span class="token punctuation">;</span>
                cur <span class="token operator">=</span> next<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> pre<span class="token punctuation">;</span>
        <span class="token punctuation">}</span></code></pre>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://Yogaguo.github.io/2019/11/08/2019-11-8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="小鱼儿">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="小鱼儿的技术博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2019/11/08/2019-11-8/" itemprop="url">
                  从JVM层理解Java方法调用
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-11-08T19:22:32+08:00">
                2019-11-08
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java基础/" itemprop="url" rel="index">
                    <span itemprop="name">Java基础</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="解析"><a href="#解析" class="headerlink" title="解析"></a>解析</h2><p>首先，方法调用不等同于方法执行，方法调用阶段唯一的任务就是确定调用方法的版本，不涉及方法内部的运行过程。</p>
<p>在Java的世界中，一切的方法调用在 Class 文件里存储的都只是符号引用， 而不是在实际运行时的内存布局的入口地址（相当于直接引用）。</p>
<p>在类加载阶段，会将其中一部分的符号引用解析为直接引用，而这种解析成立的前提是：调用目标在程序代码写好  编译期进行编译时必须确定下来。我们打这种方法的调用称为 <strong>解析</strong>。满足这种要求（编译期可知，运行期不可知）的方法包括：静态方法（与类型有关，在初始化阶段就已确定） 私有方法（外部类不可访问），它们的性质就决定了不可能通过继承什么的重写。</p>
<p>在JVM中，只要能被<strong>invokestatic</strong>和<strong>invokespecial</strong>指令调用的方法，都满足上述（在解析阶段唯一确定），符合条件的方法：静态方法 私有方法  实例构造器  父类方法。它们 在类加载阶段，会将符号引用解析为该方法的直接引用。</p>
<h2 id="静态分配"><a href="#静态分配" class="headerlink" title="静态分配"></a>静态分配</h2><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> cn<span class="token punctuation">.</span>bjtxt<span class="token punctuation">.</span>text<span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StaticDisPatch</span> <span class="token punctuation">{</span>
     <span class="token keyword">static</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">Human</span><span class="token punctuation">{</span>

    <span class="token punctuation">}</span>
     <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Man</span> <span class="token keyword">extends</span> <span class="token class-name">Human</span><span class="token punctuation">{</span>

    <span class="token punctuation">}</span>
    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Women</span> <span class="token keyword">extends</span> <span class="token class-name">Human</span><span class="token punctuation">{</span>

    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">sayHello</span><span class="token punctuation">(</span>Human guy<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"hello guy"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">sayHello</span><span class="token punctuation">(</span>Man guy<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"hello man"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">sayHello</span><span class="token punctuation">(</span>Women guy<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"hello women"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        Human man <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Man</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        Human women <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Women</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        StaticDisPatch sr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StaticDisPatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        sr<span class="token punctuation">.</span><span class="token function">sayHello</span><span class="token punctuation">(</span>man<span class="token punctuation">)</span><span class="token punctuation">;</span>
        sr<span class="token punctuation">.</span><span class="token function">sayHello</span><span class="token punctuation">(</span>women<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>运行结果：</p>
<pre class=" language-java"><code class="language-java">hello guy
hello guy
</code></pre>
<p>在上述代码中，把 “Human” 称为 静态类型，后面的 “Man” 称为实际类型，静态类型的变化只在使用时发生，变量本身不发生改变，最终的静态类型是在编译期确定的；而实际类型的变化结果在运行期才可知。编译期在编译程序时并不知道一个对象的实际类型。</p>
<p>在上述代码中，两次调用 sayHello（）方法，使用哪个重载版本，就完全取决与传入的参数的类型 数量（签名），JVM（或者说编译器）<strong>在重载时是通过参数的静态类型</strong>而不是实际类型作为判定依据的。静态类型在编译期就可以确定。</p>
<p><strong>总结：在编译期间，Javac编译期会根据参数的静态类型决定使用哪个版本，所有依赖静态类型来定位方法的执行版本的分派动作称为静态分派，典型的就是重载</strong>。</p>
<h2 id="动态分派—多态与重写"><a href="#动态分派—多态与重写" class="headerlink" title="动态分派—多态与重写"></a>动态分派—多态与重写</h2><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> cn<span class="token punctuation">.</span>bjtxt<span class="token punctuation">.</span>text<span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DynamicDisPatch</span> <span class="token punctuation">{</span>
     <span class="token keyword">static</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">Human</span><span class="token punctuation">{</span>
         <span class="token keyword">protected</span> <span class="token keyword">abstract</span> <span class="token keyword">void</span> <span class="token function">sayHello</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
     <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Man</span> <span class="token keyword">extends</span> <span class="token class-name">Human</span><span class="token punctuation">{</span>
         <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">sayHello</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
             System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"man say Hello"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span>
     <span class="token punctuation">}</span>
     <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Women</span> <span class="token keyword">extends</span> <span class="token class-name">Human</span><span class="token punctuation">{</span>
       <span class="token annotation punctuation">@Override</span>
              <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">sayHello</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                   System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"women say Hello"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

              <span class="token punctuation">}</span>        
     <span class="token punctuation">}</span>
     <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        Human man <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Man</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        Human women <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Women</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        man<span class="token punctuation">.</span><span class="token function">sayHello</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        women<span class="token punctuation">.</span><span class="token function">sayHello</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        man <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Women</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        man<span class="token punctuation">.</span><span class="token function">sayHello</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>运行结果：</p>
<pre><code>man say Hello
women say Hello
women say Hello
</code></pre><p>显然，这里不能用静态类型解释，其实造成此结果的愿意：这两个变量的实际类型不同。如果进行反编译，会发现两条 invokespecial 指令，但是两条指令的最终执行目标却不一样，这就要从 invokespecial 指令的运行时的查找过程说起：</p>
<p>首先：</p>
<ul>
<li><p>找到操作数栈顶的第一个元素所指向的对象的实际类型，标记为 A </p>
</li>
<li><p>在 类型 A 中找与常量池中的描述符和简单名称相符的方法，找到进行权限访问，通过则返回此方法的直接引用，不通过，抛异常 IIegalAccessError</p>
</li>
<li><p>找不到，按继承关系从下往上找。</p>
</li>
</ul>
<p><strong>由于 invokespecial 指令执行的第一步就是在运行期间确定接受者的实际类型</strong>，<strong>所以两次调用中的 invokespecial 指令都是把常量池的类方法符号引用解析到不同的直接引用上</strong>，<strong>这就是 重写的本质</strong>。</p>
<h2 id="单分配与多分配"><a href="#单分配与多分配" class="headerlink" title="单分配与多分配"></a>单分配与多分配</h2><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> cn<span class="token punctuation">.</span>bjtxt<span class="token punctuation">.</span>text<span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DisPatch</span> <span class="token punctuation">{</span>
  <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">QQ</span><span class="token punctuation">{</span>

  <span class="token punctuation">}</span>
  <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Weixin</span><span class="token punctuation">{</span>

  <span class="token punctuation">}</span>
  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Father</span><span class="token punctuation">{</span>
      <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">choose</span><span class="token punctuation">(</span>QQ qq<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"father choose qq"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">choose</span><span class="token punctuation">(</span>Weixin wechat<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"father choose wechat"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Son</span> <span class="token keyword">extends</span> <span class="token class-name">Father</span><span class="token punctuation">{</span>
      <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">choose</span><span class="token punctuation">(</span>QQ qq<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// TODO Auto-generated method stub</span>
         System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"son choose qq"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
      <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">choose</span><span class="token punctuation">(</span>Weixin wechat<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// TODO Auto-generated method stub</span>
         System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"son choose wechat"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    Father father <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Father</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Father son <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Son</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    father<span class="token punctuation">.</span><span class="token function">choose</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Weixin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    son<span class="token punctuation">.</span><span class="token function">choose</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">QQ</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>运行结果：</p>
<pre><code>father choose wechat
son choose qq
</code></pre><p>分析：</p>
<p>​     在编译阶段，由静态分配可知：产生的两条 invokespecial 指令的参数分别为常量池中的 Father.choose(weichat)和Father.choose(qq)方法的符号引用。</p>
<p>​    在运行时，也就是动态分配时，在执行<code>son.choose(new QQ())</code>,所对应的 invokespecial 指令时，编译期已经确定了目标方法的签名必须为 choose(QQ),JVM此时不关心传递过来的参数的类型，唯一可以影响JVM的因素就是：此方法接受的实际类型是Father还是Son </p>
<h2 id="方法表"><a href="#方法表" class="headerlink" title="方法表"></a>方法表</h2><p>由于动态分配是非常频繁的动作，基于JVM性能的考虑，常用的“优化手段”——在方法区建立一个<strong>虚方法表</strong>，表中存放着各个方法的实际入口地址。如果某个方法在子类中没有重写，那么子类的虚方法表的地址入口和父类相同方法的入口地址是一致的。都指向父类的实现入口，如果重写了，子类方法表中的地址将会指向子类实现版本的入口。</p>
<p>为了程序实现上的方便，具有相同签名的方法，在父类，子类的虚方法表中都应当具有一样的索引，这样当类型变化时，只需要变更查找的方法表。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://Yogaguo.github.io/2019/11/03/2019-11-03/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="小鱼儿">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="小鱼儿的技术博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2019/11/03/2019-11-03/" itemprop="url">
                  一致性哈希算法的原理
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-11-03T18:42:54+08:00">
                2019-11-03
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/算法/" itemprop="url" rel="index">
                    <span itemprop="name">算法</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="一种常见的场景："><a href="#一种常见的场景：" class="headerlink" title="一种常见的场景："></a>一种常见的场景：</h3><p> 工程师经常使用<strong>服务器集群</strong>来设计和实现<strong>数据缓存</strong>，经典的策略是：</p>
<ul>
<li><p>无论是添加，查询还是删除数据，都先将数据的 id 号通过哈希函数转换为一个哈希值，记为 key.</p>
</li>
<li><p>如果现在机器有 N 台，则计算 key%N 的值，这个值就是该数据所属的机器编号，无论是添加 删除 还是查询，都只是在这台机器上进行</p>
</li>
</ul>
<p>请注意，这种缓存策略可能带来一个问题：</p>
<ul>
<li>如果现在是双十一，我要<strong>加机器</strong>来满足负载，或者是有时候要<strong>去掉</strong>几台机器，N变化了，所有的数据都不得不根据 id 重新计算一遍哈希值，并将哈希值对新的机器取模，然后就是大规模的数据迁移。这个代价很高！</li>
</ul>
<p>为了解决这个问题，引入<strong>一致性哈希算法</strong>，这是一种很好的数据缓存设计方案。</p>
<p>假设所有的数据的 id 通过哈希函数转换成的哈希范围是 2^23,范围在 0 ~（2^23）-1 的数字空间中。现在我们可以将这些数字头尾相连。想象成一个闭合的环形，那么一个数据在计算出哈希值之后就会认为对应到环中的一个位置。</p>
<p>接下来，想象有三台机器通过自己的 ip 计算出来后也在这样的一个环中的各自位置上，那么一条数据如何确定归属那台机器？</p>
<ul>
<li><p>首先把数据的 id 用哈希函数计算出哈希值，并映射到环上相应位置。</p>
</li>
<li><p>然后<strong>顺时针</strong>寻找离自己位置最近的机器，这台机器就是该数据的归属。</p>
<img src="/2019/11/03/2019-11-03/1.png">

</li>
</ul>
<p>在图 6-4中，data1根据其 id 计算出的哈希值为 key1 ,顺时针的第一台机器是 machine2,所以data1归属；同理，data2归属 machine3,data3和data4归属 machine1.</p>
<p>增加机器时的处理：假设有两台机器（m1 m2）和三个数据（data1 data2 data3）,数据和机器在环上的结构图 6-5</p>
<p>如果此时想加入新的机器 m3 ,同时算出机器 m3 的 id 在 m1和 m2 右半边的环上，那么发生 的变化如图 6-6</p>
<img src="/2019/11/03/2019-11-03/2.png">

<p>在没有添加 m3 之前，从 m1 到现在 m3 位置上的这一段是 m2 掌管的一部分；添加 m3 之后统一归属 m3 ,同时要把这一段的数据从 m2 迁移到 m3 上。由此可见，添加机器时的调整是比较小的。在删除机器时也一样。只要把要删除机器中的机器全部迁移到顺时针找到的机器中。</p>
<h3 id="机器负载不均的处理"><a href="#机器负载不均的处理" class="headerlink" title="机器负载不均的处理"></a>机器负载不均的处理</h3><p> 根据哈希性质，它的离散型是随着输入域量的增加变好的，实现几乎均匀分布。如果机器较少，有可能造成机器在整个环上的分布不均匀，从而导致机器之间的负载不均衡。比如。图6-7 所示的两台机器，m1可能比m2 面临更大的负载。</p>
<img src="/2019/11/03/2019-11-03/3.png">

<p>为了解决这种问题，一致性哈希算法引入了<strong>虚拟节点机制</strong>,即对每一台机器通过不同的哈希函数计算出多个哈希值，对多个位置都放置一个服务节点，称为虚拟节点。</p>
<img src="/2019/11/03/2019-11-03/4.png">

<p>具体做法可以在机器 ip 或 hostname 的后面增加编号或端口号来实现。以图6-7的看，可以为每台机器计算两个节点，分别为m1-1 ,m1-2和m2-1 m2-2的哈希值，于是就形成了四个虚拟节点，这样节点数就变多了，根据哈希函数的性质，平衡性自然会变好。</p>
<p>当某一条数据计算出归属于m1-2时，再根据表的跳转，数据将最终归属于实际的m1机器。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://Yogaguo.github.io/2019/10/29/2019-10-29/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="小鱼儿">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="小鱼儿的技术博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2019/10/29/2019-10-29/" itemprop="url">
                  < Java并发编程的艺术>读后总结 一Java内存模型与happens-before
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-10-29T16:33:24+08:00">
                2019-10-29
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java并发编程/" itemprop="url" rel="index">
                    <span itemprop="name">Java并发编程</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Java内存模型概述"><a href="#Java内存模型概述" class="headerlink" title="Java内存模型概述"></a>Java内存模型概述</h2><p>  Java虚拟机规范试图定义一种Java内存模型(JMM)，来屏蔽各种硬件和OS的内存访问差异，让Java程在各种平台达到一致的访问效果。其实就是CPU的执行速度与内存访问的速度差异相差巨大，所以在CPU里加了几层高速缓存，有点像计算机组成原理中的Cache。</p>
<p>​    <img src="/2019/10/29/2019-10-29/01.jpg"></p>
<p>在Java内存模型中，JMM抽象出：所有变量都是存在于主存中，类似于普通内存，每个线程又包含自己的本地工作内存区，就类似于CPU的Cache，所以线程的操作都是以自己的本地工作内存为主，它们就只能访问自己的工作内存，线程写完成完成后要把值刷新会主存中。</p>
<p>在线程执行时，首先从主存中的read值，在load到工作内存中，交给CPU处理，执行完毕，再给工作内存中的变量重写赋值，最后刷新回主存。</p>
<h2 id="指令重排"><a href="#指令重排" class="headerlink" title="指令重排"></a>指令重排</h2><p>在执行程序时，为了提高性能，编译期和处理器常常会对指令进行重排序。</p>
<h3 id="数据依懒性"><a href="#数据依懒性" class="headerlink" title="数据依懒性"></a>数据依懒性</h3><p>如果两个操作操作访问同一个变量，且这两个操作中有一个 <strong>写操作</strong>，此时这两个操作就存在数据依懒性。</p>
<p>只要重排这两个操作的执行顺序，执行结果就会被改变！所以<strong>编译期和处理器不会改变存在数据依懒性的两个操作的执行顺序</strong>。</p>
<h3 id="as-if-serial-有序性"><a href="#as-if-serial-有序性" class="headerlink" title="as-if-serial(有序性)"></a>as-if-serial(有序性)</h3><p>不管如何重排序，<strong>单线程</strong>的程序执行结果不会被改变。编译期和处理器必须遵守 as-if-serial语义。所以编译期和处理器不会对存在数据依懒性的操作重排序。</p>
<p>as-if-serial语义把单线程程序 “保护起来”，</p>
<h3 id="happens-before-有序性"><a href="#happens-before-有序性" class="headerlink" title="happens-before(有序性)"></a>happens-before(有序性)</h3><p><strong>happens-before 要求前一个操作（执行的结果）对后一个操作可见，且前一个操作按顺序排在第二个操作之前。并不要求前一个操作必须要在后一个之前执行</strong></p>
<ul>
<li><p>程序顺序规则：一个线程中的每个操作，happens-before 于该线程中的任意后续操作</p>
</li>
<li><p>监视器锁规则：对一个锁的解锁，happens-before 于随后对这个锁的加锁</p>
</li>
<li><p>volatile:对一个volatile域的写，happens-before 于后续任意对这个 volatile 域的读</p>
</li>
<li><p>传递性：A happens-before B    B happens-before C ——》A happens-before C</p>
</li>
<li><p>start() 规定：线程 A 执行操作 ThreadB.start(启动线程B)，则线程 A 的 ThreadB.start 操作 happens-before 于线程B的任意操作</p>
<ul>
<li>比如：线程A在执行ThreadB.start()之前修改了一些共享变量，线程B在开始执行时会读到修改的变量</li>
</ul>
</li>
<li><p>join()规则：线程A执行操作Thread.join()并成功返回，则线程B中任意操作 happens-before于线程A从Thread.join()操作成功返回。</p>
</li>
</ul>
<h3 id="重排序对多线程的影响"><a href="#重排序对多线程的影响" class="headerlink" title="重排序对多线程的影响"></a>重排序对多线程的影响</h3><p>在单线程中，存在 as-if-serial，所以不会不会改变执行结果。但在多线程中，重排序会对执行结果修改。</p>
<p>当程序未正确同步时，就可能存在<strong>数据竞争</strong>（在一个线程读，在一个线程写，写与读未同步），当存在数据竞争时，运行结果往往不一样。如果一个多线程正确同步。就没有数据竞争。JMM对正确同步的多线程程序内存一致性做了保证：即顺序一致性（程序的执行结果与在顺序一致性内心模型中的执行结果相同）。</p>
<p><strong>而未同步的程序在JMM中执行时，整体上无序，执行结果也未知</strong></p>
<pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">T9</span> <span class="token punctuation">{</span>
     <span class="token keyword">boolean</span> runing<span class="token operator">=</span><span class="token boolean">true</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">//加上volatile，线程就会结束。否则一直死循环</span>
    <span class="token keyword">void</span> <span class="token function">m</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"m start"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">while</span><span class="token punctuation">(</span>runing<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token punctuation">}</span>
          System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"m end"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        T9 t<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">T9</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span>t<span class="token punctuation">.</span><span class="token function">m</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            TimeUnit<span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        t<span class="token punctuation">.</span>runing<span class="token operator">=</span><span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
当线程t1开始运行的时候，会把running值从内存中读到t1线程的工作区，在运行过程过程中直接使用这个copy，并不会每次都去
 读取堆内存，这样，当主线程修改running的值后，t1线程感知不到，所以不会停止运行
</code></pre>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://Yogaguo.github.io/2019/10/28/2019-10-28/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="小鱼儿">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="小鱼儿的技术博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2019/10/28/2019-10-28/" itemprop="url">
                  Java设计模式之工厂模式
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-10-28T16:48:24+08:00">
                2019-10-28
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/设计模式/" itemprop="url" rel="index">
                    <span itemprop="name">设计模式</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Java设计模式之工厂模式（简单工厂模式-工厂方法模式）"><a href="#Java设计模式之工厂模式（简单工厂模式-工厂方法模式）" class="headerlink" title="Java设计模式之工厂模式（简单工厂模式   工厂方法模式）"></a>Java设计模式之工厂模式（简单工厂模式   工厂方法模式）</h2><p> 在面向对象编程中, 最通常的方法是一个new操作符产生一个对象实例,new操作符就是用来构造对象实例的。但是在一些情况下, new操作符直接生成对象会带来一些问题。举例来说, 许多类型对象的创造需要一系列的步骤: 你可能需要计算或取得对象的初始设置; 选择生成哪个子对象实例; 或在生成你需要的对象之前必须先生成一些辅助功能的对象。 在这些情况,新对象的建立就是一个 “过程”，不仅是一个操作，像一部大机器中的一个齿轮传动。</p>
<p><strong>模式的问题</strong>：你如何能轻松方便地构造对象实例，而不必关心构造对象实例的细节和复杂过程呢？</p>
<p><strong>解决的方案</strong>：建立一个工厂来创建对象。</p>
<h3 id="分类"><a href="#分类" class="headerlink" title="分类"></a>分类</h3><p>工厂模式主要是为创建对象提供过渡接口，以便将创建对象的具体过程屏蔽隔离起来，达到提高灵活性的目的。<br>工厂模式可以分为三类： </p>
<p>1）简单工厂模式（Simple Factory）<br>2）工厂方法模式（Factory Method）<br>3）抽象工厂模式（Abstract Factory） </p>
<h3 id="简单工厂模式"><a href="#简单工厂模式" class="headerlink" title="简单工厂模式"></a>简单工厂模式</h3><img src="/2019/10/28/2019-10-28/1.png">

<p>客户想自己创建交通工具来使用客户需要知道怎么去创建一个交通,客户和交通工具就紧密耦合在一起了.为了降低耦合,就出现了工厂类,把创建工具的操作细节都放到了工厂里面去,客户直接使用工厂的创建工厂方法,传入想要的交通工具类型就行了,而不必去知道创建的细节.这就是工业革命了：简单工厂模式</p>
<pre class=" language-java"><code class="language-java">
<span class="token comment" spellcheck="true">/**
 * 产品类
 */</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">TrafficTools</span> <span class="token punctuation">{</span>
         <span class="token keyword">void</span> <span class="token function">go</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Car</span> <span class="token keyword">implements</span> <span class="token class-name">TrafficTools</span> <span class="token punctuation">{</span>
<span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">go</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Car Go!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Plane</span> <span class="token keyword">implements</span> <span class="token class-name">TrafficTools</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">go</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Plane flying!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre>
<pre class=" language-java"><code class="language-java"><span class="token operator">*</span><span class="token operator">*</span>
 <span class="token operator">*</span> 简单工厂：交通工具的工厂<span class="token punctuation">,</span>简单工厂的可扩展性不好<span class="token operator">-</span>》针对每一交通工具做个工厂
 <span class="token operator">*</span> <span class="token annotation punctuation">@author</span> LENOVO
 <span class="token operator">*</span>
 <span class="token operator">*</span><span class="token operator">/</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SimpleFactory</span> <span class="token punctuation">{</span>
   <span class="token keyword">public</span> Car <span class="token function">creatCar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token comment" spellcheck="true">//在之前可以加入其它操作:权限。。。</span>
       <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Car</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
   <span class="token keyword">public</span> Plane <span class="token function">creatPlane</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
     <span class="token comment" spellcheck="true">//在之前可以加入其它操作:权限。。。</span>
       <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Plane</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">/**
 * 客户：
 * 简单工厂：站在一个一个产品的维度看：定义创建实体产品的工厂，方便产品的扩展
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Main</span> <span class="token punctuation">{</span>
          <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
             TrafficTools f <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">creatCar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
             TrafficTools f3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">creatPlane</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>简单工厂模式又称静态工厂方法模式。重命名上就可以看出这个模式一定很简单。它存在的目的很简单：定义一个用于创建对象的接口。<br>      先来看看它的组成：<br>         1) 工厂类角色：这是本模式的核心，含有一定的商业逻辑和判断逻辑，用来创建产品<br>         2) 抽象产品角色：它一般是具体产品继承的父类或者实现的接口。<br>         3) 具体产品角色：工厂类所创建的对象就是此角色的实例。在java中由一个具体类实现。 </p>
<p>但是每增加一种交通工具，都要在工厂类中增加相应的创建业务逻辑，这显然是违背开闭原则的。可想而知对于新产品的加入，工厂类是很被动的。</p>
<h3 id="工厂方法模式"><a href="#工厂方法模式" class="headerlink" title="工厂方法模式"></a>工厂方法模式</h3><p>工厂方法模式去掉了简单工厂模式中工厂方法的静态属性，使得它可以被子类继承。这样在简单工厂模式里集中在工厂方法上的压力可以由工厂方法模式里不同的工厂子类来分担。<br>工厂方法模式组成：<br>       1)抽象工厂角色： 这是工厂方法模式的核心，它与应用程序无关。是具体工厂角色必须实现的接口或者必须继承的父类。在java中它由抽象类或者接口来实现。<br>       2)具体工厂角色：它含有和具体业务逻辑有关的代码。由应用程序调用以创建对应的具体产品的对象。<br>       3)抽象产品角色：它是具体产品继承的父类或者是实现的接口。在java中一般有抽象类或者接口来实现。<br>       4)具体产品角色：具体工厂角色所创建的对象就是此角色的实例。在java中由具体的类来实现。<br>       工厂方法模式使用继承自抽象工厂角色的多个子类来代替简单工厂模式中的“上帝类”。正如上面所说，这样便分担了对象承受的压力；而且这样使得结构变得灵活 起来——当有新的产品产生时，只要按照抽象产品角色、抽象工厂角色提供的合同来生成，那么就可以被客户使用，而不必去修改任何已有 的代码。可以看出工厂角色的结构也是符合开闭原则的</p>
<pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">/**
 * 产品类
 */</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">TrafficTools</span> <span class="token punctuation">{</span>
         <span class="token keyword">void</span> <span class="token function">go</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Car</span> <span class="token keyword">implements</span> <span class="token class-name">TrafficTools</span> <span class="token punctuation">{</span>
<span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">go</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Car Go!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Plane</span> <span class="token keyword">implements</span> <span class="token class-name">TrafficTools</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">go</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Plane flying!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<pre class=" language-java"><code class="language-java"><span class="token operator">*</span><span class="token operator">*</span>
 <span class="token operator">*</span> 工厂类
 <span class="token operator">*</span><span class="token operator">/</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CarFactory</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span>  Car <span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"create car!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">//之前做些日志工作，或者其他事情，最后在 new 出来</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Car</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PlaneFactory</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span>  Plane <span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"create plane!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">//之前做些日志工作，或者其他事情，最后在 new 出来</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Plane</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Main</span> <span class="token punctuation">{</span>
          <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span>  
             TrafficTools f <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CarFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="抽象工厂模式"><a href="#抽象工厂模式" class="headerlink" title="抽象工厂模式"></a>抽象工厂模式</h3><p>随着客户的要求越来越高，每种交通工具需要不同配置的小型武器和司机的食餐等一系类懂东西。于是这个工厂开始生产小型武器和配备不同的食物，用来满足司机或者顾客的需求。这时候工厂有两个系列的产品:武器和司机食物。 形成了<strong>产品族</strong></p>
<p>抽象工厂模式是工厂方法模式的升级版本，他用来创建一组相关或者相互依赖的对象.比如，Car 司机使用AK47,吃面包</p>
<p>Subway司机用AK46,吃蘑菇，那么使用抽象工厂，就无需为每种交通工具配置相应的东西，<strong>他会自动根据交通工具生产相应的配物</strong></p>
<pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">/**
 * 创建工厂的抽象类
 */</span>
<span class="token keyword">public</span>  <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">AbstractFactory</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">//制造食物</span>
    <span class="token keyword">abstract</span> Food <span class="token function">creatFood</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">//制造武器</span>
    <span class="token keyword">abstract</span> Weapon <span class="token function">creatWeapon</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">//制造交通工具</span>
    <span class="token keyword">abstract</span> Vehicle <span class="token function">creatVehicle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token operator">/</span><span class="token operator">*</span><span class="token operator">*</span>
  <span class="token operator">*</span> 产品类
 <span class="token operator">/</span>
 <span class="token comment" spellcheck="true">//交通工具及其种类</span>
 <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">Vehicle</span> <span class="token punctuation">{</span>
    <span class="token keyword">abstract</span> <span class="token keyword">void</span> <span class="token function">go</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Car</span>  <span class="token keyword">extends</span> <span class="token class-name">Vehicle</span><span class="token punctuation">{</span>
   <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">go</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Car Go!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Subway</span> <span class="token keyword">extends</span> <span class="token class-name">Vehicle</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">go</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"subway go"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment" spellcheck="true">//食物及其种类</span>
<span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">Food</span> <span class="token punctuation">{</span>
    <span class="token keyword">abstract</span> <span class="token keyword">void</span> <span class="token function">printName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Bread</span>  <span class="token keyword">extends</span> <span class="token class-name">Food</span><span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">printName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"面包1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Mushroom</span> <span class="token keyword">extends</span> <span class="token class-name">Food</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">printName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"小蘑菇"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">//武器及其种类</span>
<span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">Weapon</span> <span class="token punctuation">{</span>
    <span class="token keyword">abstract</span> <span class="token keyword">void</span> <span class="token function">shoot</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

 <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AK46</span> <span class="token keyword">extends</span> <span class="token class-name">Weapon</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">shoot</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"射击2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AK47</span>  <span class="token keyword">extends</span> <span class="token class-name">Weapon</span><span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">shoot</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"射击"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre>
<pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">/**
 * 产品簇:1 Car  AK47  Bread
 *       2 Subway  AK46  Mushroom
 * 在这里探讨一个问题：
 * 注意在设计中:形容词的类用 interface;名词用 Abstract
 * 抽象工厂方便于 产品簇的扩展，但是产品本身不好扩展
 * 工厂方法方便于产品本身的扩展性好。
 * 两种模式维度不同
 */</span>
<span class="token annotation punctuation">@SuppressWarnings</span><span class="token punctuation">(</span><span class="token string">"all"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Main</span> <span class="token punctuation">{</span>
          <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
           <span class="token comment" spellcheck="true">/**
            * 好处在于，你想换成subway，只需改：new CarFactory() ——》new SubwayFactory();
            */</span>
          AbstractFactory abstractFactory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CarFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          Vehicle c <span class="token operator">=</span> abstractFactory<span class="token punctuation">.</span><span class="token function">creatVehicle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          c<span class="token punctuation">.</span><span class="token function">go</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          Food b <span class="token operator">=</span> abstractFactory<span class="token punctuation">.</span><span class="token function">creatFood</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          b<span class="token punctuation">.</span><span class="token function">printName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          Weapon w <span class="token operator">=</span> abstractFactory<span class="token punctuation">.</span><span class="token function">creatWeapon</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          w<span class="token punctuation">.</span><span class="token function">shoot</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre>
<p>​    </p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://Yogaguo.github.io/2019/10/22/2019-10-23/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="小鱼儿">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="小鱼儿的技术博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2019/10/22/2019-10-23/" itemprop="url">
                  Redis初识
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-10-22T17:48:40+08:00">
                2019-10-22
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Redis/" itemprop="url" rel="index">
                    <span itemprop="name">Redis</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Redis"><a href="#Redis" class="headerlink" title="Redis"></a>Redis</h2><ul>
<li>概念：redis是一款高性能的NOSQL系列的非关系型数据库,redis内部是一个key-value存储系统。它支持存储的value类型相对更多，包括string(字符串)、list(链表)、set(集合)、zset(sorted set –有序集合)和hash（哈希类型，类似于Java中的map）。Redis基于内存运行并支持持久化的NoSQL数据库，是当前最热门的NoSql数据库之一，也被人们称为数据结构服务器.</li>
</ul>
<h3 id="为什么用-Redis"><a href="#为什么用-Redis" class="headerlink" title="为什么用 Redis"></a>为什么用 Redis</h3><p>互联网时代背景下: </p>
<ul>
<li><p>当数据量的总大小一个机器放不下时。 </p>
</li>
<li><p>数据索引一个机器的内存放不下时。 </p>
</li>
<li><p>访问量（读写混合）一个实例放不下时</p>
</li>
<li><p>单机时代：</p>
<img src="/2019/10/22/2019-10-23/1.png">

</li>
</ul>
<p>如果每次存储成千上万条数据，这样很会导致mysql的性能很差，存储以及读取速度很慢，然后就演变成缓存+mysql+垂直拆分的方式</p>
<img src="/2019/10/22/2019-10-23/2.png">

<p>Cache作为中间缓存<br>将所有的数据先保存到缓存中，然后再存入mysql中，减小数据库压力，提高效率。<br>但是当数据再次增加到又一个量级，上面的方式也不能满足需求，大部分网站开始使用主从复制技术来达到读写分离，以提高读写性能和读库的可扩展性。Mysql的master-slave模式成为这个时候的网站标配了。</p>
<img src="/2019/10/22/2019-10-23/3.png">

<p>主从分离模式<br>在redis的高速缓存，MySQL的主从复制，读写分离的基础之上，这时MySQL主库的写压力开始出现瓶颈，而数据量的持续猛增，高并发下会出现严重的锁问题，大量的高并发MySQL应用开始使用<strong>InnoDB引擎</strong>代替MyISAM。</p>
<h2 id="Redis的优势"><a href="#Redis的优势" class="headerlink" title="Redis的优势"></a>Redis的优势</h2><ul>
<li><p>易扩展</p>
</li>
<li><p>大数据量提高性能</p>
</li>
<li><p>多样灵活的数据格式</p>
</li>
</ul>
<h2 id="Redia的安装与介绍"><a href="#Redia的安装与介绍" class="headerlink" title="Redia的安装与介绍"></a>Redia的安装与介绍</h2><ol>
<li><p>官网：<a href="https://redis.io" target="_blank" rel="noopener">https://redis.io</a></p>
</li>
<li><p>中文网：<a href="http://www.redis.net.cn/" target="_blank" rel="noopener">http://www.redis.net.cn/</a></p>
</li>
<li><p>介绍：</p>
<ul>
<li>redis.windows.conf：配置文件</li>
<li>redis-cli.exe：redis的客户端</li>
<li>redis-server.exe：redis服务器端<h2 id="Redis的数据结构"><a href="#Redis的数据结构" class="headerlink" title="Redis的数据结构"></a>Redis的数据结构</h2>redis存储的是：key,value 格式的数据，其中 key 都是键值对；value 有5种不同的数据结构</li>
<li>value 的5种数据结构：</li>
<li>字符串类型 String</li>
<li>哈希类型 hash  map的格式</li>
<li>列表类型 list     linkedlist格式</li>
<li>集合类型   </li>
<li>有序集合类型  <h2 id="基本命令"><a href="#基本命令" class="headerlink" title="基本命令"></a>基本命令</h2></li>
</ul>
</li>
</ol>
<ul>
<li><p>字符串操作</p>
<ul>
<li><p>存储：<code>set key value</code></p>
</li>
<li><p>获取：<code>get key</code></p>
</li>
<li><p>删除：<code>del key</code></p>
</li>
</ul>
</li>
<li><p>哈希类型</p>
<ul>
<li><p>存储：<code>hset key field value</code></p>
</li>
<li><p>获取：</p>
<p>​       <code>hget key field</code>:获取指定的field对应的值</p>
<p>​    <code>hgetall key</code> 获取所有的field和value</p>
</li>
<li><p>删除：<code>hdel key field</code></p>
</li>
</ul>
</li>
<li><p>列表类型：可以添加一个元素到列表的头部（左边）或者尾部（右边）</p>
<ul>
<li>添加：<code>lpush key value</code>将元素加入列表左边；</li>
</ul>
</li>
</ul>
<p>​                          <code>rpush key value</code>将元素加入列表右边</p>
<p>​         获取：<code>lrange key start end</code>:范围获取</p>
<p>​         删除：<code>lpop key</code>: 删除列表左边的元素并将元素返回；<code>rpop key</code></p>
<ul>
<li><p>集合类型：不允许重复元素，元素无序</p>
<ul>
<li>存储：<code>sadd key value</code></li>
<li>获取：<code>smembers key</code>:获取 set 集合中所有的元素</li>
<li>删除：<code>srem key value</code>:删除集合中的某个元素</li>
</ul>
</li>
<li><p>有序集合：sortedset 不允许重复元素，元素有序,.每个元素都会关联一个double类型的分数。redis正是通过分数来为集合中的成员进行从小到大的排序。</p>
<ul>
<li><p>存储：<code>zadd key score value</code></p>
</li>
<li><p>获取：<code>zrange key start end</code></p>
<pre class=" language-r"><code class="language-r"><span class="token number">1</span>. 存储：zadd key score value
                <span class="token number">127.0</span>.<span class="token number">0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">></span> zadd mysort <span class="token number">60</span> zhangsan
                <span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
                <span class="token number">127.0</span>.<span class="token number">0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">></span> zadd mysort <span class="token number">50</span> lisi
                <span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
                <span class="token number">127.0</span>.<span class="token number">0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">></span> zadd mysort <span class="token number">80</span> wangwu
                <span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
            <span class="token number">2</span>. 获取：zrange key start end <span class="token punctuation">[</span>withscores<span class="token punctuation">]</span>
                <span class="token number">127.0</span>.<span class="token number">0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">></span> zrange mysort <span class="token number">0</span> <span class="token operator">-</span><span class="token number">1</span>
                <span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"lisi"</span>
                <span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"zhangsan"</span>
                <span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">"wangwu"</span>

                <span class="token number">127.0</span>.<span class="token number">0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">></span> zrange mysort <span class="token number">0</span> <span class="token operator">-</span><span class="token number">1</span> withscores
                <span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"zhangsan"</span>
                <span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"60"</span>
                <span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">"wangwu"</span>
                <span class="token number">4</span><span class="token punctuation">)</span> <span class="token string">"80"</span>
                <span class="token number">5</span><span class="token punctuation">)</span> <span class="token string">"lisi"</span>
                <span class="token number">6</span><span class="token punctuation">)</span> <span class="token string">"500"</span>
            <span class="token number">3</span>. 删除：zrem key value
                <span class="token number">127.0</span>.<span class="token number">0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">></span> zrem mysort lisi
                <span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
</code></pre>
</li>
</ul>
</li>
<li><p>通用命令</p>
<ul>
<li><code>keys *</code>查询所有的键</li>
<li><code>type key</code>键值类型</li>
<li><code>del key</code>删除指定的键值对<h2 id="Redis的持久化"><a href="#Redis的持久化" class="headerlink" title="Redis的持久化"></a>Redis的持久化</h2></li>
</ul>
<p>redis 是一个内存数据库，当Redis 服务器重启，或者电脑重启，数据多会丢失，可以将 redis 内存中的数据持久化到硬盘的文件中。</p>
</li>
<li><p>Redis 持久化的机制</p>
<ul>
<li><p>RDB:默认方式，在一定的间隔时间中，检测 key 的变化情况，然后持久化。</p>
<ul>
<li><p>1.具体操作：编辑 redis.windows.conf文件</p>
<pre class=" language-xml"><code class="language-xml">after 900 sec (15 min) if at least 1 key changed
#   after 300 sec (5 min) if at least 10 keys changed
#   after 60 sec if at least 10000 keys changed</code></pre>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<pre><code>  ```xm
  save 900 1
  save 300 10
  save 60  10000
  ```

- 重新启动redis服务器，并指定配置文件名称
  D:\redis\windows-64\redis-2.8.9&gt;redis-server.exe redis.windows.conf    </code></pre><ul>
<li>ADF:日志记录的方式，可以记录每一条命令的操作，在每一条命令后，持久化数据（不推荐）</li>
</ul>
<h2 id="Java-客户端-Jedis"><a href="#Java-客户端-Jedis" class="headerlink" title="Java 客户端 Jedis"></a>Java 客户端 Jedis</h2><ul>
<li>Jedis :一款java操作redis数据库的工具.<ul>
<li><ol>
<li>下载jedis的jar包<ul>
<li><ol start="2">
<li>使用<ul>
<li><ol>
<li>获取连接<br><code>Jedis jedis = new Jedis(&quot;localhost&quot;,6379);</code></li>
</ol>
</li>
</ul>
</li>
</ol>
<ul>
<li><ol start="2">
<li>操作<br><code>jedis.set(&quot;username&quot;,&quot;zhangsan&quot;);</code></li>
</ol>
</li>
<li><ol start="3">
<li>关闭连接<br><code>jedis.close()</code></li>
</ol>
</li>
</ul>
</li>
</ul>
</li>
</ol>
</li>
</ul>
</li>
</ul>
<ul>
<li><p>2 .Jedis操作各种redis中的数据结构</p>
<ul>
<li><p>1.字符串类型 string</p>
<pre class=" language-java"><code class="language-java"> <span class="token comment" spellcheck="true">//1. 获取连接</span>
                Jedis jedis <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Jedis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//如果使用空参构造，默认值 "localhost",6379端口</span>
                <span class="token comment" spellcheck="true">//2. 操作</span>
                <span class="token comment" spellcheck="true">//存储</span>
                jedis<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">"username"</span><span class="token punctuation">,</span><span class="token string">"zhangsan"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment" spellcheck="true">//获取</span>
                String username <span class="token operator">=</span> jedis<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"username"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token comment" spellcheck="true">//可以使用setex()方法存储可以指定过期时间的 key value</span>
                jedis<span class="token punctuation">.</span><span class="token function">setex</span><span class="token punctuation">(</span><span class="token string">"activecode"</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token string">"hehe"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//将activecode：hehe键值对存入redis，并且20秒后自动删除该键值对</span>

                <span class="token comment" spellcheck="true">//3. 关闭连接</span>
                jedis<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<ul>
<li><p>哈希类型 hash ： map格式  </p>
<p>hset</p>
<p>hget<br>hgetAll</p>
<pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">//1. 获取连接</span>
               Jedis jedis <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Jedis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//如果使用空参构造，默认值 "localhost",6379端口</span>
               <span class="token comment" spellcheck="true">//2. 操作</span>
               <span class="token comment" spellcheck="true">// 存储hash</span>
               jedis<span class="token punctuation">.</span><span class="token function">hset</span><span class="token punctuation">(</span><span class="token string">"user"</span><span class="token punctuation">,</span><span class="token string">"name"</span><span class="token punctuation">,</span><span class="token string">"lisi"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
               jedis<span class="token punctuation">.</span><span class="token function">hset</span><span class="token punctuation">(</span><span class="token string">"user"</span><span class="token punctuation">,</span><span class="token string">"age"</span><span class="token punctuation">,</span><span class="token string">"23"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
               jedis<span class="token punctuation">.</span><span class="token function">hset</span><span class="token punctuation">(</span><span class="token string">"user"</span><span class="token punctuation">,</span><span class="token string">"gender"</span><span class="token punctuation">,</span><span class="token string">"female"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

               <span class="token comment" spellcheck="true">// 获取hash</span>
               String name <span class="token operator">=</span> jedis<span class="token punctuation">.</span><span class="token function">hget</span><span class="token punctuation">(</span><span class="token string">"user"</span><span class="token punctuation">,</span> <span class="token string">"name"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
               System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<pre><code>                   // 获取hash的所有map中的数据
                   Map&lt;String, String&gt; user = jedis.hgetAll(&quot;user&quot;);

                   // keyset
                   Set&lt;String&gt; keySet = user.keySet();
                   for (String key : keySet) {
                       //获取value
                       String value = user.get(key);
                       System.out.println(key + &quot;:&quot; + value);
                   }

                   //3. 关闭连接
                   jedis.close();
   ```</code></pre><h2 id="Jdeis连接池"><a href="#Jdeis连接池" class="headerlink" title="Jdeis连接池"></a>Jdeis连接池</h2><ul>
<li><ol>
<li>创建JedisPool连接池对象</li>
</ol>
</li>
<li><ol start="2">
<li><p>调用方法 getResource()方法获取Jedis连接</p>
<pre><code> ```java</code></pre><p>连接池工具类</p>
<pre><code>       public class JedisPoolUtils {

           private static JedisPool jedisPool;

           static{
               //读取配置文件
               InputStream is = JedisPoolUtils.class.getClassLoader().getResourceAsStream(&quot;jedis.properties&quot;);
               //创建Properties对象
               Properties pro = new Properties();
               //关联文件
               try {
                   pro.load(is);
               } catch (IOException e) {
                   e.printStackTrace();
               }
               //获取数据，设置到JedisPoolConfig中
               JedisPoolConfig config = new JedisPoolConfig();
               config.setMaxTotal(Integer.parseInt(pro.getProperty(&quot;maxTotal&quot;)));
               config.setMaxIdle(Integer.parseInt(pro.getProperty(&quot;maxIdle&quot;)));

               //初始化JedisPool
               jedisPool = new JedisPool(config,pro.getProperty(&quot;host&quot;),Integer.parseInt(pro.getProperty(&quot;port&quot;)));</code></pre></li>
</ol>
</li>
</ul>
<pre><code>                }


                /**
                 * 获取连接方法
                 */
                public static Jedis getJedis(){
                    return jedisPool.getResource();
                }
            }
      ```</code></pre>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://Yogaguo.github.io/2019/10/22/2019-10-22/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="小鱼儿">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="小鱼儿的技术博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2019/10/22/2019-10-22/" itemprop="url">
                  Ajax与JSON
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-10-22T15:20:51+08:00">
                2019-10-22
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="AJAX："><a href="#AJAX：" class="headerlink" title="AJAX："></a>AJAX：</h1><pre><code>1. 概念： ASynchronous JavaScript And XML    异步的JavaScript 和 XML
    1. 异步和同步：客户端和服务器端相互通信的基础上
        * 客户端必须等待服务器端的响应。在等待的期间客户端不能做其他操作。
        * 客户端不需要等待服务器端的响应。在服务器处理请求的过程中，客户端可以进行其他的操作。

        Ajax 是一种在无需重新加载整个网页的情况下，能够更新部分网页的技术。 [1] 
        通过在后台与服务器进行少量数据交换，Ajax 可以使网页实现异步更新。这意味着可以在不重新加载整个网页的情况下，对网页的某部分进行更新。
        传统的网页（不使用 Ajax）如果需要更新内容，必须重载整个网页页面。

        提升用户的体验

2. 实现方式：
    1. 原生的JS实现方式（了解）
                 //1.创建核心对象
                var xmlhttp;
                if (window.XMLHttpRequest)
                {// code for IE7+, Firefox, Chrome, Opera, Safari
                    xmlhttp=new XMLHttpRequest();
                }
                else
                {// code for IE6, IE5
                    xmlhttp=new ActiveXObject(&quot;Microsoft.XMLHTTP&quot;);
                }

                //2. 建立连接
                /*
                    参数：
                        1. 请求方式：GET、POST
                            * get方式，请求参数在URL后边拼接。send方法为空参
                            * post方式，请求参数在send方法中定义
                        2. 请求的URL：
                        3. 同步或异步请求：true（异步）或 false（同步）

                 */
                xmlhttp.open(&quot;GET&quot;,&quot;ajaxServlet?username=tom&quot;,true);

                //3.发送请求
                xmlhttp.send();

                //4.接受并处理来自服务器的响应结果
                //获取方式 ：xmlhttp.responseText
                //什么时候获取？当服务器响应成功后再获取

                //当xmlhttp对象的就绪状态改变时，触发事件onreadystatechange。
                xmlhttp.onreadystatechange=function()
                {
                    //判断readyState就绪状态是否为4，判断status响应状态码是否为200
                    if (xmlhttp.readyState==4 &amp;&amp; xmlhttp.status==200)
                    {
                       //获取服务器的响应结果
                        var responseText = xmlhttp.responseText;
                        alert(responseText);
                    }
                }
    2. JQeury实现方式
        1. $.ajax()
            * 语法：$.ajax({键值对});
             //使用$.ajax()发送异步请求
                $.ajax({
                    url:&quot;ajaxServlet1111&quot; , // 请求路径
                    type:&quot;POST&quot; , //请求方式
                    //data: &quot;username=jack&amp;age=23&quot;,//请求参数
                    data:{&quot;username&quot;:&quot;jack&quot;,&quot;age&quot;:23},
                    success:function (data) {
                        alert(data);
                    },//响应成功后的回调函数
                    error:function () {
                        alert(&quot;出错啦...&quot;)
                    },//表示如果请求响应出现错误，会执行的回调函数

                    dataType:&quot;text&quot;//设置接受到的响应数据的格式
                });
        2. $.get()：发送get请求
            * 语法：$.get(url, [data], [callback], [type])
                * 参数：
                    * url：请求路径
                    * data：请求参数
                    * callback：回调函数
                    * type：响应结果的类型

        3. $.post()：发送post请求
            * 语法：$.post(url, [data], [callback], [type])
                * 参数：
                    * url：请求路径
                    * data：请求参数
                    * callback：回调函数
                    * type：响应结果的类型</code></pre><h1 id="JSON："><a href="#JSON：" class="headerlink" title="JSON："></a>JSON：</h1><pre><code>1. 概念： JavaScript Object Notation        JavaScript对象表示法
    Person p = new Person();
    p.setName(&quot;张三&quot;);
    p.setAge(23);
    p.setGender(&quot;男&quot;);

    var p = {&quot;name&quot;:&quot;张三&quot;,&quot;age&quot;:23,&quot;gender&quot;:&quot;男&quot;};

    * json现在多用于存储和交换文本信息的语法
    * 进行数据的传输
    * JSON 比 XML 更小、更快，更易解析。

2. 语法：
    1. 基本规则
        * 数据在名称/值对中：json数据是由键值对构成的
            * 键用引号(单双都行)引起来，也可以不使用引号
            * 值得取值类型：
                1. 数字（整数或浮点数）
                2. 字符串（在双引号中）
                3. 逻辑值（true 或 false）
                4. 数组（在方括号中）    {&quot;persons&quot;:[{},{}]}
                5. 对象（在花括号中） {&quot;address&quot;:{&quot;province&quot;：&quot;陕西&quot;....}}
                6. null
        * 数据由逗号分隔：多个键值对由逗号分隔
        * 花括号保存对象：使用{}定义json 格式
        * 方括号保存数组：[]
    2. 获取数据:
        1. json对象.键名
        2. json对象[&quot;键名&quot;]
        3. 数组对象[索引]
        4. 遍历
                 //1.定义基本格式
                var person = {&quot;name&quot;: &quot;张三&quot;, age: 23, &#39;gender&#39;: true};

                var ps = [{&quot;name&quot;: &quot;张三&quot;, &quot;age&quot;: 23, &quot;gender&quot;: true},
                    {&quot;name&quot;: &quot;李四&quot;, &quot;age&quot;: 24, &quot;gender&quot;: true},
                    {&quot;name&quot;: &quot;王五&quot;, &quot;age&quot;: 25, &quot;gender&quot;: false}];</code></pre><p>​<br>​<br>​<br>                    //获取person对象中所有的键和值<br>                    //for in 循环<br>                   /* for(var key in person){<br>                        //这样的方式获取不行。因为相当于  person.”name”<br>                        //alert(key + “:” + person.key);<br>                        alert(key+”:”+person[key]);<br>                    }*/</p>
<pre><code>               //获取ps中的所有值
                for (var i = 0; i &lt; ps.length; i++) {
                    var p = ps[i];
                    for(var key in p){
                        alert(key+&quot;:&quot;+p[key]);
                    }
                }</code></pre><pre class=" language-java"><code class="language-java"><span class="token number">3</span><span class="token punctuation">.</span> JSON数据和Java对象的相互转换

    <span class="token operator">*</span> JSON解析器：
        <span class="token operator">*</span> 常见的解析器：Jsonlib，Gson，fastjson，jackson

    <span class="token number">1</span><span class="token punctuation">.</span> JSON转为Java对象
        <span class="token number">1</span><span class="token punctuation">.</span> 导入jackson的相关jar包
        <span class="token number">2</span><span class="token punctuation">.</span> 创建Jackson核心对象 ObjectMapper
        <span class="token number">3</span><span class="token punctuation">.</span> 调用ObjectMapper的相关方法进行转换
            <span class="token number">1</span><span class="token punctuation">.</span> <span class="token function">readValue</span><span class="token punctuation">(</span>json字符串数据<span class="token punctuation">,</span>Class<span class="token punctuation">)</span>
    <span class="token number">2</span><span class="token punctuation">.</span> Java对象转换JSON
        <span class="token number">1</span><span class="token punctuation">.</span> 使用步骤：
            <span class="token number">1</span><span class="token punctuation">.</span> 导入jackson的相关jar包
            <span class="token number">2</span><span class="token punctuation">.</span> 创建Jackson核心对象 ObjectMapper
            <span class="token number">3</span><span class="token punctuation">.</span> 调用ObjectMapper的相关方法进行转换
                <span class="token number">1</span><span class="token punctuation">.</span> 转换方法：
                    <span class="token operator">*</span> <span class="token function">writeValue</span><span class="token punctuation">(</span>参数<span class="token number">1</span>，obj<span class="token punctuation">)</span><span class="token operator">:</span>
                        参数<span class="token number">1</span>：
                            File：将obj对象转换为JSON字符串，并保存到指定的文件中
                            Writer：将obj对象转换为JSON字符串，并将json数据填充到字符输出流中
                            OutputStream：将obj对象转换为JSON字符串，并将json数据填充到字节输出流中
                    <span class="token operator">*</span> <span class="token function">writeValueAsString</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token operator">:</span>将对象转为json字符串

                <span class="token number">2</span><span class="token punctuation">.</span> 注解：
                    <span class="token number">1</span><span class="token punctuation">.</span> <span class="token annotation punctuation">@JsonIgnore</span>：排除属性。
                    <span class="token number">2</span><span class="token punctuation">.</span> <span class="token annotation punctuation">@JsonFormat</span>：属性值得格式化
                        <span class="token operator">*</span> <span class="token annotation punctuation">@JsonFormat</span><span class="token punctuation">(</span>pattern <span class="token operator">=</span> <span class="token string">"yyyy-MM-dd"</span><span class="token punctuation">)</span>

                <span class="token number">3</span><span class="token punctuation">.</span> 复杂java对象转换
                    <span class="token number">1</span><span class="token punctuation">.</span> List：数组
                    <span class="token number">2</span><span class="token punctuation">.</span> Map：对象格式一致</code></pre>
<h1 id="案例："><a href="#案例：" class="headerlink" title="案例："></a>案例：</h1><pre class=" language-java"><code class="language-java"><span class="token operator">*</span> 校验用户名是否存在
    <span class="token number">1</span><span class="token punctuation">.</span> 服务器响应的数据，在客户端使用时，要想当做json数据格式使用。有两种解决方案：
        <span class="token number">1</span><span class="token punctuation">.</span> $<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span><span class="token operator">:</span>将最后一个参数type指定为<span class="token string">"json"</span>
        <span class="token number">2</span><span class="token punctuation">.</span> 在服务器端设置MIME类型
            response<span class="token punctuation">.</span><span class="token function">setContentType</span><span class="token punctuation">(</span><span class="token string">"application/json;charset=utf-8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://Yogaguo.github.io/2019/10/17/2019-10-17/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="小鱼儿">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="小鱼儿的技术博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2019/10/17/2019-10-17/" itemprop="url">
                  2019-10-17
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-10-17T21:43:04+08:00">
                2019-10-17
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="类加载机制顺序及具体细节"><a href="#类加载机制顺序及具体细节" class="headerlink" title="类加载机制顺序及具体细节"></a>类加载机制顺序及具体细节</h2><p>首先知道，类从被加载到虚拟机内存中开始，到卸载出内存，整个生命周期包括：加载 (Loading)  验证（Verification）</p>
<p>准备（Preparation）解析（Resolution）初始化（Initialization）使用（Using）卸载（Unloading;</p>
<p>其中 验证 准备 解析 统称为 链接（Linking)</p>
<h3 id="什么时候进行初始化"><a href="#什么时候进行初始化" class="headerlink" title="什么时候进行初始化"></a>什么时候进行初始化</h3><ul>
<li>1.遇到 new getstatic  等 4条字节码指令时，如果类没有进行初始化，则先初始化。</li>
<li>2.使用<strong>反射调用</strong>时。</li>
<li>3.父类还没有进行初始化时，先触发父类初始化</li>
<li>4.</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://Yogaguo.github.io/2019/10/16/2019-10-16/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="小鱼儿">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="小鱼儿的技术博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2019/10/16/2019-10-16/" itemprop="url">
                  设计模式之模板方法总结
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-10-16T19:05:04+08:00">
                2019-10-16
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/设计模式/" itemprop="url" rel="index">
                    <span itemprop="name">设计模式</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="模板方法定义"><a href="#模板方法定义" class="headerlink" title="模板方法定义"></a>模板方法定义</h3><p><strong>模板方法模式(template method pattern</strong>:定义一个操作中的某种算法的框架，而将一些步骤延迟到子类中。</p>
<p>模板方法模式使得子类在不改变一个算法结构的前提下，对这些步骤进行一些特定化的定义. </p>
<p>&lt; !–more–&gt;</p>
<h3 id="模板方法的程序组成架构"><a href="#模板方法的程序组成架构" class="headerlink" title="模板方法的程序组成架构"></a>模板方法的程序组成架构</h3><p>   在模板方法模式中，存在一个父类（也可以是父接口），其中包括两类方法：模板放法和步骤方法。</p>
<h4 id="模板方法"><a href="#模板方法" class="headerlink" title="模板方法"></a>模板方法</h4><p>实现某种算法的方法步骤。而这些步骤都是调用的步骤方法完成的。注意，子类不要重写，为了防止，定义为 <strong>final</strong></p>
<h4 id="步骤方法"><a href="#步骤方法" class="headerlink" title="步骤方法"></a>步骤方法</h4><p>完成模板方法的每个阶段性方法。每个步骤方法完成某一特定的  完成总算法的一部分功能</p>
<p>步骤方法有三种类型：抽象方法    最终方法   钩子方法</p>
<h5 id="抽象方法"><a href="#抽象方法" class="headerlink" title="抽象方法"></a>抽象方法</h5><p>要求子类必须要实现的方法，是完成模板方法的算法步骤中必须由子类完成的个性化定义</p>
<h5 id="最终方法"><a href="#最终方法" class="headerlink" title="最终方法"></a>最终方法</h5><p>子类不能重写的方法，是：若要完成模板方法的算法步骤，对于所有子类执行都一样的步骤</p>
<h5 id="钩子方法"><a href="#钩子方法" class="headerlink" title="钩子方法"></a>钩子方法</h5><p>是父类给的<strong>默认实现</strong>，子类可以重写，通常在父类中给出的是一个<strong>空实现</strong>，并以该空实现作为方法的默认实现，钩子方法</p>
<p>也可以提供一个非空的的默认实现</p>
<h3 id="具体案例展示"><a href="#具体案例展示" class="headerlink" title="具体案例展示"></a>具体案例展示</h3><pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> Dome<span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">abstract</span>  <span class="token keyword">class</span> <span class="token class-name">Shopping</span> <span class="token punctuation">{</span>
  <span class="token comment" spellcheck="true">//模板方法</span>
    <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">void</span> <span class="token function">buyGoods</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">userLogin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">buy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">pay</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment" spellcheck="true">//子类不能重写的方法</span>
    <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">void</span> <span class="token function">userLogin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"用户登录"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment" spellcheck="true">//子类必须实现</span>
    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">void</span> <span class="token function">buy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

   <span class="token comment" spellcheck="true">//钩子方法</span>
   <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">pay</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"使用微信支付"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">ShoesShopping</span> <span class="token keyword">extends</span> <span class="token class-name">Shopping</span><span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">buy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"购买运动鞋"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">ClothesShopping</span> <span class="token keyword">extends</span> <span class="token class-name">Shopping</span><span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">buy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"购买衣服"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">pay</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"使用支付宝支付"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre>
<pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> Dome<span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Test</span> <span class="token punctuation">{</span>
       <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        Shopping shoes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ShoesShopping</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        shoes<span class="token punctuation">.</span><span class="token function">buyGoods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"=================="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        Shopping clothes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ClothesShopping</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                clothes<span class="token punctuation">.</span><span class="token function">buyGoods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>输出结果：</p>
<pre><code>用户登录
购买运动鞋
使用微信支付
==================
用户登录
购买衣服
使用支付宝支付
</code></pre><h3 id="扩展"><a href="#扩展" class="headerlink" title="扩展"></a>扩展</h3><p>  在 JDK 的集合源码中 ArrayList 就是用了模板方法模式设计的。 ArrayList继承自 AbstractList 抽象类 ，而 AbstractList </p>
<p>  有继承自 AbstractCollection </p>
<img src="/2019/10/16/2019-10-16/1.PNG">
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image" src="/images/avatar.gif" alt="小鱼儿">
          <p class="site-author-name" itemprop="name">小鱼儿</p>
           
              <p class="site-description motion-element" itemprop="description">技术博客，Java编程，算法学习</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">22</span>
                <span class="site-state-item-name">posts</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">16</span>
                <span class="site-state-item-name">categories</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">23</span>
                <span class="site-state-item-name">tags</span>
              </a>
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">小鱼儿</span>
</div>


<div class="powered-by">
  Powered by <a class="theme-link" href="https://hexo.io">Hexo</a>
</div>

<div class="theme-info">
  Theme -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  






  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  


  




	





  





  





  






  





  

  

  

  

</body>
</html>
